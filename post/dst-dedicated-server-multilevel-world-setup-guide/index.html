<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content=" 此文全程处于linux环境，阅读此文需具备一些linux使用经验。\n解决饥荒卡顿有两个方法，如果你是单人联机玩家，可以添加长路独行模组，开启后就可以获得与单机版相同的游戏体验，此模组的原理的注意事项可以点此查看。 对于联机玩家，可以搭建专用服务器优化卡顿。饥荒联机版专用服务器 (Don&rsquo;t Starve Together Dedicated Server) 是由 klei 官方提供的一个工具，购买饥荒联机版后，在Steam 的“库”页面勾选 &ldquo;TOOLS&rdquo; 后就可以看到了。 专用服务器可以在云服务器或PC上运行。如果你的电脑配置还可以，并且不要求服务器全天运行，完全可以在自己电脑上搭建专用服务器。 运行专用服务器每个世界大约需要1G内存，同时运行游戏本身也需要内存，因此内存最好在8G以上。如图1所示，第一个进程是游戏本身，占用了1.2G的内存，第二个进程是专用服务器，占用了995M左右的内存。\n"><title>饥荒联机版专用服务器和多层世界配置指南</title><link rel=canonical href=https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/><link rel=stylesheet href=/scss/style.min.cd033c8bf6f54611ce5d0a49cb3084ca04001d4a92d12a9156081a173f3c2f14.css><meta property='og:title' content="饥荒联机版专用服务器和多层世界配置指南"><meta property='og:description' content=" 此文全程处于linux环境，阅读此文需具备一些linux使用经验。\n解决饥荒卡顿有两个方法，如果你是单人联机玩家，可以添加长路独行模组，开启后就可以获得与单机版相同的游戏体验，此模组的原理的注意事项可以点此查看。 对于联机玩家，可以搭建专用服务器优化卡顿。饥荒联机版专用服务器 (Don&rsquo;t Starve Together Dedicated Server) 是由 klei 官方提供的一个工具，购买饥荒联机版后，在Steam 的“库”页面勾选 &ldquo;TOOLS&rdquo; 后就可以看到了。 专用服务器可以在云服务器或PC上运行。如果你的电脑配置还可以，并且不要求服务器全天运行，完全可以在自己电脑上搭建专用服务器。 运行专用服务器每个世界大约需要1G内存，同时运行游戏本身也需要内存，因此内存最好在8G以上。如图1所示，第一个进程是游戏本身，占用了1.2G的内存，第二个进程是专用服务器，占用了995M左右的内存。\n"><meta property='og:url' content='https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/'><meta property='og:site_name' content='陈默的博客'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='DST'><meta property='article:published_time' content='2023-06-09T00:00:00+00:00'><meta property='article:modified_time' content='2023-06-09T00:00:00+00:00'><meta property='og:image' content='https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/1.png'><meta name=twitter:title content="饥荒联机版专用服务器和多层世界配置指南"><meta name=twitter:description content=" 此文全程处于linux环境，阅读此文需具备一些linux使用经验。\n解决饥荒卡顿有两个方法，如果你是单人联机玩家，可以添加长路独行模组，开启后就可以获得与单机版相同的游戏体验，此模组的原理的注意事项可以点此查看。 对于联机玩家，可以搭建专用服务器优化卡顿。饥荒联机版专用服务器 (Don&rsquo;t Starve Together Dedicated Server) 是由 klei 官方提供的一个工具，购买饥荒联机版后，在Steam 的“库”页面勾选 &ldquo;TOOLS&rdquo; 后就可以看到了。 专用服务器可以在云服务器或PC上运行。如果你的电脑配置还可以，并且不要求服务器全天运行，完全可以在自己电脑上搭建专用服务器。 运行专用服务器每个世界大约需要1G内存，同时运行游戏本身也需要内存，因此内存最好在8G以上。如图1所示，第一个进程是游戏本身，占用了1.2G的内存，第二个进程是专用服务器，占用了995M左右的内存。\n"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/1.png'><link rel="shortcut icon" href=/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_4e8d1d67bfa58bac.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🍥</span></figure><div class=site-meta><h1 class=site-name><a href=/>陈默的博客</a></h1><h2 class=site-description>Nothing happened to me</h2></div></header><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>首页</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>归档</span></a></li><li><a href=/diaries/><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<span>日记</span></a></li><li><a href=/notes/><svg class="icon icon-tabler icon-tabler-infinity" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M9.828 9.172a4 4 0 100 5.656A10 10 0 0012 12a10 10 0 012.172-2.828 4 4 0 110 5.656A10 10 0 0112 12 10 10 0 009.828 9.172"/></svg>
<span>笔记</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>搜索</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#饥荒存档的构成>饥荒存档的构成</a></li><li><a href=#在本地运行专用服务器>在本地运行专用服务器</a><ol><li><a href=#准备存档文件>准备存档文件</a></li><li><a href=#准备专用服务器和模组>准备专用服务器和模组</a></li><li><a href=#启动专用服务器>启动专用服务器</a></li></ol></li><li><a href=#在云服务器运行专用服务器>在云服务器运行专用服务器</a></li><li><a href=#多层世界>多层世界</a></li><li><a href=#常见问题>常见问题</a><ol><li><a href=#connecting-anonymously-to-steam-public-retry-retry>Connecting anonymously to Steam Public&mldr;: Retry Retry</a></li><li><a href=#服务器启动失败-cluster_tokentxt-do-not-exist>服务器启动失败: cluster_token.txt do not exist</a></li><li><a href=#服务器启动失败-libcurl-gnultsso4>服务器启动失败: libcurl-gnults.so.4</a></li><li><a href=#全部模组没有添加成功>全部模组没有添加成功</a></li><li><a href=#部分模组没有添加成功>部分模组没有添加成功</a></li><li><a href=#游戏大厅内无法搜索到世界>游戏大厅内无法搜索到世界</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/post/dst-dedicated-server-multilevel-world-setup-guide/><img src=/post/dst-dedicated-server-multilevel-world-setup-guide/1_hu_c5c8e51ae73c7a59.png srcset="/post/dst-dedicated-server-multilevel-world-setup-guide/1_hu_c5c8e51ae73c7a59.png 800w, /post/dst-dedicated-server-multilevel-world-setup-guide/1_hu_22a9d884ccb99603.png 1600w" width=800 height=575 loading=lazy alt="Featured image of post 饥荒联机版专用服务器和多层世界配置指南"></a></div><div class=article-details><header class=article-category><a href=/categories/dst/>饥荒联机版</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/post/dst-dedicated-server-multilevel-world-setup-guide/>饥荒联机版专用服务器和多层世界配置指南</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2023-06-09</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 8 分钟</time></div></footer></div></header><section class=article-content><blockquote><p>此文全程处于<code>linux</code>环境，阅读此文需具备一些<code>linux</code>使用经验。</p></blockquote><p>解决饥荒卡顿有两个方法，如果你是单人联机玩家，可以添加<a class=link href="https://steamcommunity.com/sharedfiles/filedetails/?id=2657513551" target=_blank rel=noopener>长路独行</a>模组，开启后就可以获得与单机版相同的游戏体验，此模组的原理的注意事项可以<a class=link href=https://dont-starve-mod.github.io/zh/dsa_index/ target=_blank rel=noopener>点此查看</a>。
对于联机玩家，可以搭建专用服务器优化卡顿。饥荒联机版专用服务器 (Don&rsquo;t Starve Together Dedicated Server) 是由 klei 官方提供的一个工具，购买饥荒联机版后，在Steam 的“库”页面勾选 &ldquo;TOOLS&rdquo; 后就可以看到了。
专用服务器可以在云服务器或PC上运行。如果你的电脑配置还可以，并且不要求服务器全天运行，完全可以在自己电脑上搭建专用服务器。
运行专用服务器每个世界大约需要<code>1G</code>内存，同时运行游戏本身也需要内存，因此内存最好在<code>8G</code>以上。如图1所示，第一个进程是游戏本身，占用了<code>1.2G</code>的内存，第二个进程是专用服务器，占用了<code>995M</code>左右的内存。</p><p><img src=/post/dst-dedicated-server-multilevel-world-setup-guide/3.png width=781 height=117 srcset="/post/dst-dedicated-server-multilevel-world-setup-guide/3_hu_a5d89c1ceef36e2f.png 480w, /post/dst-dedicated-server-multilevel-world-setup-guide/3_hu_17300349174998ac.png 1024w" loading=lazy alt=图1 class=gallery-image data-flex-grow=667 data-flex-basis=1602px></p><h2 id=饥荒存档的构成>饥荒存档的构成</h2><blockquote><p>使用游戏本身创建的存档最多可以有一个森林和一个洞穴。但是饥荒专用服务器支持一个存档内包含任意多个森林和洞穴。</p></blockquote><p>专用服务器的运行单位是一个世界，而不是一个存档。比如说，一个存档中包括2个森林和2个洞穴，那么就需要启动4个专用服务器的进程实例。当然，你也可以不运行全部的世界，如果你不打算去某个世界，完全可以不启动它。这些进程通过网络通信，由于这种灵活的方式，你完全可以将一个存档中的不同的世界运行在不同的电脑上 (当然一般不需要这么做，除非你的世界太大了以至于一台电脑运行起来吃力)。</p><p>唯一的限制是，每个存档必须有且仅有一个主世界 (Master Shard)，所有其他的世界都需要绑定到主世界。为了区分，每个世界都有一个唯一的<code>id</code>，通过给洞穴入口或洞穴出口绑定不同的<code>id</code>，玩家就可以通过他们在多个世界之间穿越。旺达的溯源表也绑定了世界的<code>id</code>，因此可以穿越到不同的世界。如图2所示，这是一个拥有两个森林和两个洞穴的世界。其中一个森林是主世界，箭头代表可以通过洞穴入口或洞穴出口进出另一个世界。</p><p><img src=/post/dst-dedicated-server-multilevel-world-setup-guide/1.png width=4572 height=3284 srcset="/post/dst-dedicated-server-multilevel-world-setup-guide/1_hu_d15d8a795bf7eee.png 480w, /post/dst-dedicated-server-multilevel-world-setup-guide/1_hu_4f11717f69268b1f.png 1024w" loading=lazy alt=图2 class=gallery-image data-flex-grow=139 data-flex-basis=334px></p><p>这个世界对应的存档结构如下:</p><div class=collapsible-code><div class=code-header onclick=toggleCode(this)><span class=icon>▼</span></div><div class=code-body><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>.
</span></span><span class=line><span class=cl>├── <span class=o>[</span>drwxr-xr-x<span class=o>]</span>  Master
</span></span><span class=line><span class=cl>├── <span class=o>[</span>drwxr-xr-x<span class=o>]</span>  Cave1
</span></span><span class=line><span class=cl>├── <span class=o>[</span>drwxr-xr-x<span class=o>]</span>  Cave2
</span></span><span class=line><span class=cl>├── <span class=o>[</span>drwxr-xr-x<span class=o>]</span>  Forest1
</span></span><span class=line><span class=cl>├── <span class=o>[</span>-rw-r--r--<span class=o>]</span>  cluster.ini
</span></span><span class=line><span class=cl>└── <span class=o>[</span>-rw-r--r--<span class=o>]</span>  cluster_token.txt</span></span></code></pre></td></tr></table></div></div></div></div><style>.collapsible-code .code-body{overflow:hidden;margin-left:calc((var(--card-padding)) * -1);margin-right:calc((var(--card-padding)) * -1);width:calc(100% + var(--card-padding) * 2);padding:0 var(--card-padding)}.collapsible-code .code-header{display:flex;align-items:center;cursor:pointer;user-select:none}.collapsible-code .code-header .icon{font-size:.65em;color:var(--card-text-color-main);transition:transform .2s ease}.collapsible-code.collapsed .code-body{display:none}.collapsible-code.collapsed .icon{transform:rotate(-90deg)}</style><script>function toggleCode(e){const t=e.closest(".collapsible-code");t.classList.toggle("collapsed")}</script><p>可以看出，每个世界都对应一个文件夹。此外，<code>cluster.ini</code>存放了世界的一些参数设置，<code>cluster_token.txt</code>里存放了用户的身份令牌 (身份令牌的获取参见下一章)。这些就是一个 存档的完整内容。
也可以去查看<code>~/.klei/DontStarveTogether/$SteamUserID/</code>目录，如果你在本地创建了存档，那么这个目录下就会有以<code>Cluster_X</code>格式命名的文件夹，其中<code>X</code>是此存档在游戏中显示的位置。如图3所示，我创建了一个存档，那么此文件夹中就有一个<code>Cluster_1</code>。</p><p><img src=/post/dst-dedicated-server-multilevel-world-setup-guide/2.png width=1336 height=584 srcset="/post/dst-dedicated-server-multilevel-world-setup-guide/2_hu_e5399fa5443f3845.png 480w, /post/dst-dedicated-server-multilevel-world-setup-guide/2_hu_dae6b3a704a2a372.png 1024w" loading=lazy alt=图3 class=gallery-image data-flex-grow=228 data-flex-basis=549px></p><p>查看目录结构，可以看出我只添加了一个主世界，没有添加洞穴。由于只有在专用服务器上运行的存档才需要<code>cluster_token.txt</code>，因此这里没有。</p><div class=collapsible-code><div class=code-header onclick=toggleCode(this)><span class=icon>▼</span></div><div class=code-body><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>
</span></span><span class=line><span class=cl>```bash
</span></span><span class=line><span class=cl>Cluster_1
</span></span><span class=line><span class=cl>├── Master
</span></span><span class=line><span class=cl>└── cluster.ini</span></span></code></pre></td></tr></table></div></div></div></div><style>.collapsible-code .code-body{overflow:hidden;margin-left:calc((var(--card-padding)) * -1);margin-right:calc((var(--card-padding)) * -1);width:calc(100% + var(--card-padding) * 2);padding:0 var(--card-padding)}.collapsible-code .code-header{display:flex;align-items:center;cursor:pointer;user-select:none}.collapsible-code .code-header .icon{font-size:.65em;color:var(--card-text-color-main);transition:transform .2s ease}.collapsible-code.collapsed .code-body{display:none}.collapsible-code.collapsed .icon{transform:rotate(-90deg)}</style><script>function toggleCode(e){const t=e.closest(".collapsible-code");t.classList.toggle("collapsed")}</script><h2 id=在本地运行专用服务器>在本地运行专用服务器</h2><h3 id=准备存档文件>准备存档文件</h3><p>在游戏中创建存档，添加好要启用的模组并设置好世界的参数后生成世界。等待世界生成，进入选人物的步骤后，断开连接。</p><blockquote><p>一定要添加洞穴，否则存档无法在专用服务器中运行。</p></blockquote><p>进入<code>~/.klei/DontStarveTogether/$SteamUserID/</code>目录，将刚刚创建的存档<code>Cluster_X</code>(<code>X</code>是此存档在游戏中显示的位置)移动到<code>~/.klei/DontStarveTogether/</code>中。</p><div class=collapsible-code><div class=code-header onclick=toggleCode(this)><span class=icon>▼</span></div><div class=code-body><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>cd</span> ~/.klei/DontStarveTogether/<span class=nv>$SteamUserID</span>/
</span></span><span class=line><span class=cl>mv Cluster_X ..</span></span></code></pre></td></tr></table></div></div></div></div><style>.collapsible-code .code-body{overflow:hidden;margin-left:calc((var(--card-padding)) * -1);margin-right:calc((var(--card-padding)) * -1);width:calc(100% + var(--card-padding) * 2);padding:0 var(--card-padding)}.collapsible-code .code-header{display:flex;align-items:center;cursor:pointer;user-select:none}.collapsible-code .code-header .icon{font-size:.65em;color:var(--card-text-color-main);transition:transform .2s ease}.collapsible-code.collapsed .code-body{display:none}.collapsible-code.collapsed .icon{transform:rotate(-90deg)}</style><script>function toggleCode(e){const t=e.closest(".collapsible-code");t.classList.toggle("collapsed")}</script><p>使用浏览器打开<a class=link href=https://accounts.klei.com/login target=_blank rel=noopener>Klei Account</a>，登录自己的<code>Klei</code>账号，可以使用<code>Steam</code>登录。登录成功后进入如下页面。</p><p><img src=/post/dst-dedicated-server-multilevel-world-setup-guide/4.png width=1904 height=964 srcset="/post/dst-dedicated-server-multilevel-world-setup-guide/4_hu_773e06c67885510e.png 480w, /post/dst-dedicated-server-multilevel-world-setup-guide/4_hu_b944523b3fc0a23d.png 1024w" loading=lazy alt=图4 class=gallery-image data-flex-grow=197 data-flex-basis=474px></p><p>点击导航栏中的<code>游戏</code>，在游戏列表中点击<code>《饥荒：联机版》的游戏服务器</code>，如下图所示。</p><p><img src=/post/dst-dedicated-server-multilevel-world-setup-guide/5.png width=1365 height=843 srcset="/post/dst-dedicated-server-multilevel-world-setup-guide/5_hu_745328fdd52dbb11.png 480w, /post/dst-dedicated-server-multilevel-world-setup-guide/5_hu_9e2f93c1abe22259.png 1024w" loading=lazy alt=图5 class=gallery-image data-flex-grow=161 data-flex-basis=388px></p><p>随便起一个名字，点击<code>添加新服务器</code>，然后复制生成的以<code>pds-g^</code>开头的代码，如下图所示。</p><p><img src=/post/dst-dedicated-server-multilevel-world-setup-guide/6.png width=1320 height=565 srcset="/post/dst-dedicated-server-multilevel-world-setup-guide/6_hu_6d14b992fb944b33.png 480w, /post/dst-dedicated-server-multilevel-world-setup-guide/6_hu_c37e44ad656196a3.png 1024w" loading=lazy alt=图6 class=gallery-image data-flex-grow=233 data-flex-basis=560px></p><p>在<code>~/.klei/DontStarveTogether/Cluster_X</code>中创建<code>cluster_token.txt</code>文件，内容为刚刚复制的代码。</p><div class=collapsible-code><div class=code-header onclick=toggleCode(this)><span class=icon>▼</span></div><div class=code-body><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>echo</span> <span class=s2>&#34;pds-g^...&#34;</span> &gt; cluster_token.txt</span></span></code></pre></td></tr></table></div></div></div></div><style>.collapsible-code .code-body{overflow:hidden;margin-left:calc((var(--card-padding)) * -1);margin-right:calc((var(--card-padding)) * -1);width:calc(100% + var(--card-padding) * 2);padding:0 var(--card-padding)}.collapsible-code .code-header{display:flex;align-items:center;cursor:pointer;user-select:none}.collapsible-code .code-header .icon{font-size:.65em;color:var(--card-text-color-main);transition:transform .2s ease}.collapsible-code.collapsed .code-body{display:none}.collapsible-code.collapsed .icon{transform:rotate(-90deg)}</style><script>function toggleCode(e){const t=e.closest(".collapsible-code");t.classList.toggle("collapsed")}</script><p>至此，存档文件就准备好了。</p><h3 id=准备专用服务器和模组>准备专用服务器和模组</h3><p>在<code>Steam</code>中安装<code>Don't Starve Together Dedicated Server</code>，进入安装目录 (安装目录可以在<code>Steam</code>的游戏设置中找到)。
如果你的存档添加了模组，则需要修改<code>mods</code>文件夹下的<code>dedicated_server_mods_setup.lua</code>文件。专用服务器启动时，会根据这个文件的内容自动更新模组，如果你只在存档中添加了模组但是没有修改这个文件，则模组会添加失败。将需要添加的模组的<code>id</code>以如下这种格式添加到此文件中即可。</p><div class=collapsible-code><div class=code-header onclick=toggleCode(this)><span class=icon>▼</span></div><div class=code-body><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=n>ServerModSetup</span><span class=p>(</span><span class=s2>&#34;1438233888&#34;</span><span class=p>)</span> <span class=c1>--多层世界选择器</span>
</span></span><span class=line><span class=cl><span class=n>ServerModSetup</span><span class=p>(</span><span class=s2>&#34;1418746242&#34;</span><span class=p>)</span> <span class=c1>--汉化增强 Chinese++</span>
</span></span><span class=line><span class=cl><span class=n>ServerModSetup</span><span class=p>(</span><span class=s2>&#34;666155465&#34;</span><span class=p>)</span> <span class=c1>--show me</span></span></span></code></pre></td></tr></table></div></div></div></div><style>.collapsible-code .code-body{overflow:hidden;margin-left:calc((var(--card-padding)) * -1);margin-right:calc((var(--card-padding)) * -1);width:calc(100% + var(--card-padding) * 2);padding:0 var(--card-padding)}.collapsible-code .code-header{display:flex;align-items:center;cursor:pointer;user-select:none}.collapsible-code .code-header .icon{font-size:.65em;color:var(--card-text-color-main);transition:transform .2s ease}.collapsible-code.collapsed .code-body{display:none}.collapsible-code.collapsed .icon{transform:rotate(-90deg)}</style><script>function toggleCode(e){const t=e.closest(".collapsible-code");t.classList.toggle("collapsed")}</script><p>模组的<code>id</code>可以通过<code>Steam</code>创意工坊中的链接查看。在<code>Steam</code>中模组的详情页面右击空白处，选择<code>Copy Page URL</code>。链接末尾的<code>?id=</code>后接的就是它的<code>id</code>。例如<code>Show Me</code>的创意工坊链接为<code>https://steamcommunity.com/sharedfiles/filedetails/?id=666155465</code>，其<code>id</code>为<code>666155465</code>。
除了这种方式，还可以查看此存档中主世界目录中的<code>modoverrides.lua</code>文件，这个文件保存了当前世界启用的模组的设置。格式如下所示，其中<code>workshop-</code>后接的数字就是模组的<code>id</code>。</p><div class=collapsible-code><div class=code-header onclick=toggleCode(this)><span class=icon>▼</span></div><div class=code-body><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=cl><span class=kr>return</span><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=p>[</span><span class=s2>&#34;workshop-1418746242&#34;</span><span class=p>]</span><span class=o>=</span><span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=p>[</span><span class=s2>&#34;configuration_options&#34;</span><span class=p>]</span><span class=o>=</span><span class=p>{</span> <span class=p>[</span><span class=s2>&#34;clearfont&#34;</span><span class=p>]</span><span class=o>=</span><span class=kc>true</span><span class=err>，</span>
</span></span><span class=line><span class=cl>      <span class=p>[</span><span class=s2>&#34;eventplus&#34;</span><span class=p>]</span><span class=o>=</span><span class=kc>true</span><span class=err>，</span>
</span></span><span class=line><span class=cl>      <span class=p>[</span><span class=s2>&#34;extratrans&#34;</span><span class=p>]</span><span class=o>=</span><span class=kc>true</span> 
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=p>[</span><span class=s2>&#34;enabled&#34;</span><span class=p>]</span><span class=o>=</span><span class=kc>true</span> 
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></td></tr></table></div></div></div></div><style>.collapsible-code .code-body{overflow:hidden;margin-left:calc((var(--card-padding)) * -1);margin-right:calc((var(--card-padding)) * -1);width:calc(100% + var(--card-padding) * 2);padding:0 var(--card-padding)}.collapsible-code .code-header{display:flex;align-items:center;cursor:pointer;user-select:none}.collapsible-code .code-header .icon{font-size:.65em;color:var(--card-text-color-main);transition:transform .2s ease}.collapsible-code.collapsed .code-body{display:none}.collapsible-code.collapsed .icon{transform:rotate(-90deg)}</style><script>function toggleCode(e){const t=e.closest(".collapsible-code");t.classList.toggle("collapsed")}</script><p>既然<code>modoverrides.lua</code>文件已经保存了模组的<code>id</code>，那么我们就可以使用脚本将所有添加的模组的<code>id</code>提取出来。如下命令会根据<code>modoverrides.lua</code>文件自动生成<code>dedicated_server_mods_setup.lua</code>文件。<code>cd</code>到<code>modoverrides.lua</code>所在目录中执行如下命令，然后将生成的文件复制到<code>专用服务器安装目录/mods</code>文件夹覆盖原有文件即可。</p><div class=collapsible-code><div class=code-header onclick=toggleCode(this)><span class=icon>▼</span></div><div class=code-body><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>cat ./modoverrides.lua <span class=p>|</span> grep -E <span class=s1>&#39;\[&#34;workshop-[0-9]+&#34;\].*&#39;</span> <span class=p>|</span> sed  -r  <span class=s1>&#39;s/\[&#34;workshop-([0-9]+)&#34;\].*/ServerModSetup(&#34;\1&#34;)/g&#39;</span> &gt; dedicated_server_mods_setup.lua</span></span></code></pre></td></tr></table></div></div></div></div><style>.collapsible-code .code-body{overflow:hidden;margin-left:calc((var(--card-padding)) * -1);margin-right:calc((var(--card-padding)) * -1);width:calc(100% + var(--card-padding) * 2);padding:0 var(--card-padding)}.collapsible-code .code-header{display:flex;align-items:center;cursor:pointer;user-select:none}.collapsible-code .code-header .icon{font-size:.65em;color:var(--card-text-color-main);transition:transform .2s ease}.collapsible-code.collapsed .code-body{display:none}.collapsible-code.collapsed .icon{transform:rotate(-90deg)}</style><script>function toggleCode(e){const t=e.closest(".collapsible-code");t.classList.toggle("collapsed")}</script><h3 id=启动专用服务器>启动专用服务器</h3><p><code>cd</code>到安装目录中的<code>bin64</code>文件夹，执行</p><div class=collapsible-code><div class=code-header onclick=toggleCode(this)><span class=icon>▼</span></div><div class=code-body><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./dontstarve_dedicated_server_nullrenderer_x64  -console -cluster <span class=s2>&#34;Cluster_X&#34;</span> -monitor_parent_process <span class=nv>$$</span> -shard Caves <span class=p>&amp;</span>
</span></span><span class=line><span class=cl>./dontstarve_dedicated_server_nullrenderer_x64  -console -cluster <span class=s2>&#34;Cluster_X&#34;</span> -monitor_parent_process <span class=nv>$$</span> -shard Master</span></span></code></pre></td></tr></table></div></div></div></div><style>.collapsible-code .code-body{overflow:hidden;margin-left:calc((var(--card-padding)) * -1);margin-right:calc((var(--card-padding)) * -1);width:calc(100% + var(--card-padding) * 2);padding:0 var(--card-padding)}.collapsible-code .code-header{display:flex;align-items:center;cursor:pointer;user-select:none}.collapsible-code .code-header .icon{font-size:.65em;color:var(--card-text-color-main);transition:transform .2s ease}.collapsible-code.collapsed .code-body{display:none}.collapsible-code.collapsed .icon{transform:rotate(-90deg)}</style><script>function toggleCode(e){const t=e.closest(".collapsible-code");t.classList.toggle("collapsed")}</script><p><code>-console</code>指定在游戏中启用控制台。
<code>-cluster</code>指定存档的名字，这个名字和要运行的存档文件夹名对应。
<code>-shard</code>指定世界碎片的名字。同样，这个名字也要和世界碎片的文件夹名对应。</p><blockquote><p>在<code>cluster.ini</code>中也可以指定一个名称，这个名称是在游戏中玩家看的世界名称。而<code>-cluster</code>指定的只是文件夹的名称，在游戏中是看不到的。</p></blockquote><h2 id=在云服务器运行专用服务器>在云服务器运行专用服务器</h2><p>购买阿里云或腾讯云提供的云服务器，配置选择<code>1核2G</code>或者<code>2核4G</code>即可。安装<code>Debian</code>或<code>Ubuntu</code>操作系统，在安全组中开放<code>10888-10999</code>端口。此处以<code>Debian</code>为例。</p><div class=collapsible-code><div class=code-header onclick=toggleCode(this)><span class=icon>▼</span></div><div class=code-body><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>       _,met<span class=nv>$$$$$gg</span>.          momo@debian 
</span></span><span class=line><span class=cl>    ,g<span class=nv>$$$$$$$$$$$$$$$P</span>.       ----------- 
</span></span><span class=line><span class=cl>  ,g<span class=nv>$$</span>P<span class=s2>&#34;     &#34;&#34;&#34;</span>Y<span class=nv>$$</span>.<span class=s2>&#34;.        OS: Debian GNU/Linux 11 (bullseye) x86_64 
</span></span></span><span class=line><span class=cl><span class=s2> ,</span><span class=nv>$$</span><span class=s2>P&#39;              `</span><span class=nv>$$</span>$<span class=s2>.     Host: VirtualBox 1.2 
</span></span></span><span class=line><span class=cl><span class=s2>&#39;,</span><span class=nv>$$</span><span class=s2>P       ,ggs.     `</span><span class=nv>$$</span><span class=s2>b:   Kernel: 5.10.0-23-amd64 
</span></span></span><span class=line><span class=cl><span class=s2>`d</span><span class=nv>$$</span><span class=s2>&#39;     ,</span><span class=nv>$P</span><span class=s2>&#34;</span><span class=s1>&#39;   .    $$$    Uptime: 1 min 
</span></span></span><span class=line><span class=cl><span class=s1> $$P      d$&#39;</span>     ，   <span class=nv>$$</span>P    Packages: <span class=m>444</span> <span class=o>(</span>dpkg<span class=o>)</span> 
</span></span><span class=line><span class=cl> <span class=nv>$$</span>:      <span class=nv>$$</span>.   -    ,d<span class=nv>$$</span><span class=s1>&#39;    Shell: bash 5.1.4 
</span></span></span><span class=line><span class=cl><span class=s1> $$;      Y$b._   _,d$P&#39;</span>      Resolution: preferred 
</span></span><span class=line><span class=cl> Y<span class=nv>$$</span>.    <span class=sb>`</span>.<span class=sb>`</span><span class=s2>&#34;Y</span><span class=nv>$$$$</span><span class=s2>P&#34;</span><span class=err>&#39;</span>         Terminal: /dev/pts/0 
</span></span><span class=line><span class=cl> <span class=sb>`</span><span class=nv>$$</span>b      <span class=s2>&#34;-.__              CPU: Intel i5-7300HQ (2) @ 2.496GHz 
</span></span></span><span class=line><span class=cl><span class=s2>  `Y</span><span class=nv>$$</span><span class=s2>                        GPU: 00:02.0 VMware SVGA II Adapter 
</span></span></span><span class=line><span class=cl><span class=s2>   `Y</span><span class=nv>$$</span><span class=s2>.                      Memory: 78MiB / 3919MiB 
</span></span></span><span class=line><span class=cl><span class=s2>     `</span><span class=nv>$$</span><span class=s2>b.
</span></span></span><span class=line><span class=cl><span class=s2>       `Y</span><span class=nv>$$</span><span class=s2>b.                                         
</span></span></span><span class=line><span class=cl><span class=s2>          `&#34;</span>Y<span class=nv>$b</span>._                                     
</span></span><span class=line><span class=cl>              <span class=sb>`</span><span class=s2>&#34;&#34;&#34;</span></span></span></code></pre></td></tr></table></div></div></div></div><style>.collapsible-code .code-body{overflow:hidden;margin-left:calc((var(--card-padding)) * -1);margin-right:calc((var(--card-padding)) * -1);width:calc(100% + var(--card-padding) * 2);padding:0 var(--card-padding)}.collapsible-code .code-header{display:flex;align-items:center;cursor:pointer;user-select:none}.collapsible-code .code-header .icon{font-size:.65em;color:var(--card-text-color-main);transition:transform .2s ease}.collapsible-code.collapsed .code-body{display:none}.collapsible-code.collapsed .icon{transform:rotate(-90deg)}</style><script>function toggleCode(e){const t=e.closest(".collapsible-code");t.classList.toggle("collapsed")}</script><ul><li>添加<code>32</code>位支持</li></ul><div class=collapsible-code><div class=code-header onclick=toggleCode(this)><span class=icon>▼</span></div><div class=code-body><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo dpkg --add-architecture i386
</span></span><span class=line><span class=cl>sudo apt update <span class=o>&amp;&amp;</span> sudo apt upgrade -y</span></span></code></pre></td></tr></table></div></div></div></div><style>.collapsible-code .code-body{overflow:hidden;margin-left:calc((var(--card-padding)) * -1);margin-right:calc((var(--card-padding)) * -1);width:calc(100% + var(--card-padding) * 2);padding:0 var(--card-padding)}.collapsible-code .code-header{display:flex;align-items:center;cursor:pointer;user-select:none}.collapsible-code .code-header .icon{font-size:.65em;color:var(--card-text-color-main);transition:transform .2s ease}.collapsible-code.collapsed .code-body{display:none}.collapsible-code.collapsed .icon{transform:rotate(-90deg)}</style><script>function toggleCode(e){const t=e.closest(".collapsible-code");t.classList.toggle("collapsed")}</script><ul><li>安装依赖</li></ul><div class=collapsible-code><div class=code-header onclick=toggleCode(this)><span class=icon>▼</span></div><div class=code-body><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt install libstdc++6:i386 libgcc1:i386 libcurl4-gnutls-dev:i386 -y</span></span></code></pre></td></tr></table></div></div></div></div><style>.collapsible-code .code-body{overflow:hidden;margin-left:calc((var(--card-padding)) * -1);margin-right:calc((var(--card-padding)) * -1);width:calc(100% + var(--card-padding) * 2);padding:0 var(--card-padding)}.collapsible-code .code-header{display:flex;align-items:center;cursor:pointer;user-select:none}.collapsible-code .code-header .icon{font-size:.65em;color:var(--card-text-color-main);transition:transform .2s ease}.collapsible-code.collapsed .code-body{display:none}.collapsible-code.collapsed .icon{transform:rotate(-90deg)}</style><script>function toggleCode(e){const t=e.closest(".collapsible-code");t.classList.toggle("collapsed")}</script><ul><li>安装<code>SteamCMD</code></li></ul><div class=collapsible-code><div class=code-header onclick=toggleCode(this)><span class=icon>▼</span></div><div class=code-body><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 这一步的速度视网络环境而定</span>
</span></span><span class=line><span class=cl>mkdir -p ~/steamcmd/
</span></span><span class=line><span class=cl><span class=nb>cd</span> ~/steamcmd/
</span></span><span class=line><span class=cl>wget <span class=s2>&#34;https://steamcdn-a.akamaihd.net/client/installer/steamcmd_linux.tar.gz&#34;</span>
</span></span><span class=line><span class=cl>tar -xvzf steamcmd_linux.tar.gz</span></span></code></pre></td></tr></table></div></div></div></div><style>.collapsible-code .code-body{overflow:hidden;margin-left:calc((var(--card-padding)) * -1);margin-right:calc((var(--card-padding)) * -1);width:calc(100% + var(--card-padding) * 2);padding:0 var(--card-padding)}.collapsible-code .code-header{display:flex;align-items:center;cursor:pointer;user-select:none}.collapsible-code .code-header .icon{font-size:.65em;color:var(--card-text-color-main);transition:transform .2s ease}.collapsible-code.collapsed .code-body{display:none}.collapsible-code.collapsed .icon{transform:rotate(-90deg)}</style><script>function toggleCode(e){const t=e.closest(".collapsible-code");t.classList.toggle("collapsed")}</script><ul><li>准备存档文件
这一步骤与上一章中的相同，可以在本地生成存档文件夹，然后上传到服务器。</li></ul><div class=collapsible-code><div class=code-header onclick=toggleCode(this)><span class=icon>▼</span></div><div class=code-body><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 在服务器</span>
</span></span><span class=line><span class=cl>mkdir -p ~/.klei/DoNotStarveTogether
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 在本地</span>
</span></span><span class=line><span class=cl><span class=nb>cd</span> ~/.klei/DoNotStarveTogether
</span></span><span class=line><span class=cl>scp -r ./Cluster_X username@xxx.xxx.xxx.xxx:~/.klei/DoNotStarveTogether/</span></span></code></pre></td></tr></table></div></div></div></div><style>.collapsible-code .code-body{overflow:hidden;margin-left:calc((var(--card-padding)) * -1);margin-right:calc((var(--card-padding)) * -1);width:calc(100% + var(--card-padding) * 2);padding:0 var(--card-padding)}.collapsible-code .code-header{display:flex;align-items:center;cursor:pointer;user-select:none}.collapsible-code .code-header .icon{font-size:.65em;color:var(--card-text-color-main);transition:transform .2s ease}.collapsible-code.collapsed .code-body{display:none}.collapsible-code.collapsed .icon{transform:rotate(-90deg)}</style><script>function toggleCode(e){const t=e.closest(".collapsible-code");t.classList.toggle("collapsed")}</script><ul><li>将以下内容写入<code>run_server.sh</code>文件并赋予其执行权限。</li></ul><div class=collapsible-code><div class=code-header onclick=toggleCode(this)><span class=icon>▼</span></div><div class=code-body><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=nv>steamcmd_dir</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$HOME</span><span class=s2>/steamcmd&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>install_dir</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$HOME</span><span class=s2>/dontstarvetogether_dedicated_server&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>cluster_name</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>dontstarve_dir</span><span class=o>=</span><span class=s2>&#34;</span><span class=nv>$HOME</span><span class=s2>/.klei/DoNotStarveTogether&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> fail<span class=o>()</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=nb>echo</span> Error: <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span> &gt;<span class=p>&amp;</span><span class=m>2</span>
</span></span><span class=line><span class=cl>  <span class=nb>exit</span> <span class=m>1</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>function</span> check_for_file<span class=o>()</span>
</span></span><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=o>[</span> ! -e <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
</span></span><span class=line><span class=cl>          fail <span class=s2>&#34;Missing file: </span><span class=nv>$1</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=k>fi</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>cd</span> <span class=s2>&#34;</span><span class=nv>$steamcmd_dir</span><span class=s2>&#34;</span> <span class=o>||</span> fail <span class=s2>&#34;Missing </span><span class=nv>$steamcmd_dir</span><span class=s2> directory!&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>check_for_file <span class=s2>&#34;steamcmd.sh&#34;</span>
</span></span><span class=line><span class=cl>check_for_file <span class=s2>&#34;</span><span class=nv>$dontstarve_dir</span><span class=s2>/</span><span class=nv>$cluster_name</span><span class=s2>/cluster.ini&#34;</span>
</span></span><span class=line><span class=cl>check_for_file <span class=s2>&#34;</span><span class=nv>$dontstarve_dir</span><span class=s2>/</span><span class=nv>$cluster_name</span><span class=s2>/cluster_token.txt&#34;</span>
</span></span><span class=line><span class=cl>check_for_file <span class=s2>&#34;</span><span class=nv>$dontstarve_dir</span><span class=s2>/</span><span class=nv>$cluster_name</span><span class=s2>/Master/server.ini&#34;</span>
</span></span><span class=line><span class=cl>check_for_file <span class=s2>&#34;</span><span class=nv>$dontstarve_dir</span><span class=s2>/</span><span class=nv>$cluster_name</span><span class=s2>/Caves/server.ini&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>./steamcmd.sh +force_install_dir <span class=s2>&#34;</span><span class=nv>$install_dir</span><span class=s2>&#34;</span> +login anonymous +app_update <span class=m>343050</span> validate +quit
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>check_for_file <span class=s2>&#34;</span><span class=nv>$install_dir</span><span class=s2>/bin64&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>cat <span class=s2>&#34;</span><span class=nv>$dontstarve_dir</span><span class=s2>/</span><span class=nv>$cluster_name</span><span class=s2>/Master/modoverrides.lua&#34;</span> <span class=p>|</span> grep -E <span class=s1>&#39;\[&#34;workshop-[0-9]+&#34;\].*&#39;</span> <span class=p>|</span> sed  -r  <span class=s1>&#39;s/\[&#34;workshop-([0-9]+)&#34;\].*/ServerModSetup(&#34;\1&#34;)/g&#39;</span> &gt; <span class=s2>&#34;</span><span class=nv>$install_dir</span><span class=s2>/mods/dedicated_server_mods_setup.lua&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>cd</span> <span class=s2>&#34;</span><span class=nv>$install_dir</span><span class=s2>/bin64&#34;</span> <span class=o>||</span> fail
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>run_shared</span><span class=o>=(</span>./dontstarve_dedicated_server_nullrenderer_x64<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nv>run_shared</span><span class=o>+=(</span>-console<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nv>run_shared</span><span class=o>+=(</span>-cluster <span class=s2>&#34;</span><span class=nv>$cluster_name</span><span class=s2>&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nv>run_shared</span><span class=o>+=(</span>-monitor_parent_process <span class=nv>$$</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=s2>&#34;</span><span class=si>${</span><span class=nv>run_shared</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&#34;</span> -shard Caves  <span class=p>|</span> sed <span class=s1>&#39;s/^/Caves:  /&#39;</span> <span class=p>&amp;</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;</span><span class=si>${</span><span class=nv>run_shared</span><span class=p>[@]</span><span class=si>}</span><span class=s2>&#34;</span> -shard Master <span class=p>|</span> sed <span class=s1>&#39;s/^/Master: /&#39;</span></span></span></code></pre></td></tr></table></div></div></div></div><style>.collapsible-code .code-body{overflow:hidden;margin-left:calc((var(--card-padding)) * -1);margin-right:calc((var(--card-padding)) * -1);width:calc(100% + var(--card-padding) * 2);padding:0 var(--card-padding)}.collapsible-code .code-header{display:flex;align-items:center;cursor:pointer;user-select:none}.collapsible-code .code-header .icon{font-size:.65em;color:var(--card-text-color-main);transition:transform .2s ease}.collapsible-code.collapsed .code-body{display:none}.collapsible-code.collapsed .icon{transform:rotate(-90deg)}</style><script>function toggleCode(e){const t=e.closest(".collapsible-code");t.classList.toggle("collapsed")}</script><p>这个脚本是我在<code>Klei</code>官方提供的脚本的基础上优化修改而来。运行时需要提供存档文件夹的名称作为脚本的第一个参数。脚本将会检查存档文件是否完整，使用<code>SteamCMD</code>更新专用服务器并根据存档的模组设置文件<code>modoverrides.lua</code>自动生成<code>dedicated_server_mods_setup.lua</code>文件。</p><ul><li>运行脚本</li></ul><div class=collapsible-code><div class=code-header onclick=toggleCode(this)><span class=icon>▼</span></div><div class=code-body><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./run_server.sh Cluster_X</span></span></code></pre></td></tr></table></div></div></div></div><style>.collapsible-code .code-body{overflow:hidden;margin-left:calc((var(--card-padding)) * -1);margin-right:calc((var(--card-padding)) * -1);width:calc(100% + var(--card-padding) * 2);padding:0 var(--card-padding)}.collapsible-code .code-header{display:flex;align-items:center;cursor:pointer;user-select:none}.collapsible-code .code-header .icon{font-size:.65em;color:var(--card-text-color-main);transition:transform .2s ease}.collapsible-code.collapsed .code-body{display:none}.collapsible-code.collapsed .icon{transform:rotate(-90deg)}</style><script>function toggleCode(e){const t=e.closest(".collapsible-code");t.classList.toggle("collapsed")}</script><p>由于第一次运行时要下载专用服务器，速度会比较慢。当终端输出<code>Sim paused</code>时就说明启动完毕，可以在游戏中搜索加入了。</p><blockquote><p>可以使用<code>tmux</code>或<code>screen</code>等工具，这样脚本就可以在后台运行了。</p></blockquote><h2 id=多层世界>多层世界</h2><p>理论上来说，一个存档中可以添加无数个世界。配置多层世界需要修改存档根目录中的<code>cluster.ini</code>和每个世界目录中的<code>server.ini</code>。
首先看一下的<code>cluster.ini</code>的内容。</p><blockquote><p>TODO 文件内容分析</p></blockquote><p>使用多层世界选择器可以解决给洞穴入口绑定<code>id</code>的麻烦。类似于路由器的工作方式，玩家选择目标世界，由多层世界选择器将玩家送到对应世界，如图7所示。</p><p><img src=/post/dst-dedicated-server-multilevel-world-setup-guide/7.png width=5284 height=3284 srcset="/post/dst-dedicated-server-multilevel-world-setup-guide/7_hu_a7a906cb0a78475b.png 480w, /post/dst-dedicated-server-multilevel-world-setup-guide/7_hu_482376d2d41c2926.png 1024w" loading=lazy alt=图7 class=gallery-image data-flex-grow=160 data-flex-basis=386px></p><h2 id=常见问题>常见问题</h2><h3 id=connecting-anonymously-to-steam-public-retry-retry>Connecting anonymously to Steam Public&mldr;: Retry Retry</h3><p>无法连接到<code>Steam</code>的服务器，这一般是由于<code>GFW</code>，科学上网即可解决。</p><h3 id=服务器启动失败-cluster_tokentxt-do-not-exist>服务器启动失败: cluster_token.txt do not exist</h3><p>检查<code>cluster_token.txt</code>是否存在，内容是否正确。</p><h3 id=服务器启动失败-libcurl-gnultsso4>服务器启动失败: libcurl-gnults.so.4</h3><p>安装<code>libcurl-gnults</code>。</p><h3 id=全部模组没有添加成功>全部模组没有添加成功</h3><p>查看<code>modoverrides.lua</code>和<code>dedicated_server_mods_setup.lua</code>是否都存在，内容是否正确。</p><h3 id=部分模组没有添加成功>部分模组没有添加成功</h3><p>因为网络原因，有时专用服务器会在下载某些模组时失败。如果运行后发现只有一部分模组，一般重新运行专用服务器即可。</p><h3 id=游戏大厅内无法搜索到世界>游戏大厅内无法搜索到世界</h3><p>可以通过控制台指令<code>c_connect("xxx.xxx.xxx.xxx"，10999，"password")</code>加入世界，其中第一个参数是服务器的<code>IP</code>地址，第二个参数是主世界碎片的端口号，第三个参数是世界的密码。</p></section><footer class=article-footer><section class=article-tags><a href=/tags/dst/>DST</a></section></footer></article><div id=gitalk-container></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css><script src=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js></script><script src=https://cdn.jsdelivr.net/npm/blueimp-md5@2.18.0/js/md5.min.js></script><script>const gitalk=new Gitalk({clientID:"f2a85a008ac7f0051f7c",clientSecret:"e2ddd4b1fbb431f43b3f2a97c2ff476e5ec385b5",repo:"blog_comments",owner:"chenkeao",admin:["chenkeao"],distractionFreeMode:!1,id:md5(location.pathname),proxy:null});(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("gitalk-container").innerHTML="Gitalk comments not available by default when the website is previewed locally.";return}gitalk.render("gitalk-container")})()</script><footer class=site-footer><section class=copyright>&copy;
2023 -
2025 陈默的博客</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>