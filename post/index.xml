<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts on 陈默的博客</title><link>https://chenkeao.github.io/post/</link><description>Recent content in Posts on 陈默的博客</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Fri, 13 Jun 2025 12:29:01 +0800</lastBuildDate><atom:link href="https://chenkeao.github.io/post/index.xml" rel="self" type="application/rss+xml"/><item><title>Convert IPynb to PDF With Reporting Format</title><link>https://chenkeao.github.io/post/convert-ipynb-to-pdf-with-reporting-format/</link><pubDate>Fri, 13 Jun 2025 12:29:01 +0800</pubDate><guid>https://chenkeao.github.io/post/convert-ipynb-to-pdf-with-reporting-format/</guid><description>&lt;p>Install &lt;code>nbconvert&lt;/code> via &lt;code>pip&lt;/code>&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">pip install nbconvert&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>Now, the command&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">jupyter nbconvert --to pdf --template-file report filename.ipynb&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>should work well, producing a document with a table of contents and properly formatted code blocks. However, an unnecessary counter appears before each code block, wasting space and serving no purpose. To remove it, a custom template is required.&lt;/p>
&lt;p>The template consists of two files: &lt;code>assignment.tex.j2&lt;/code> and &lt;code>style_assignment.tex.j2&lt;/code>, which are modified duplicates of existing files. Template files are located in &lt;code>share\jupyter\nbconvert\templates\latex&lt;/code>. Duplicate &lt;code>report.tex.j2&lt;/code> and modify the second line to&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-latex" data-lang="latex">&lt;span class="line">&lt;span class="cl">((* set cell&lt;span class="nb">_&lt;/span>style = &amp;#39;style&lt;span class="nb">_&lt;/span>assignment.tex.j2&amp;#39; *))&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>The file &lt;code>style_assignment.tex.j2&lt;/code> is a duplicate of &lt;code>style_jupyter.tex.j2&lt;/code> with the line&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-latex" data-lang="latex">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">{&lt;/span>&lt;span class="k">\ttfamily\llap&lt;/span>&lt;span class="nb">{{&lt;/span>&lt;span class="k">\color&lt;/span>&lt;span class="nb">{&lt;/span>#2&lt;span class="nb">}&lt;/span>[#3]:&lt;span class="k">\hspace&lt;/span>&lt;span class="nb">{&lt;/span>3pt&lt;span class="nb">}&lt;/span>#4&lt;span class="nb">}}&lt;/span>&lt;span class="k">\vspace&lt;/span>&lt;span class="nb">{&lt;/span>-&lt;span class="k">\baselineskip&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>replaced by&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-latex" data-lang="latex">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">{&lt;/span>&lt;span class="k">\ttfamily\llap&lt;/span>&lt;span class="nb">{{&lt;/span>&lt;span class="k">\color&lt;/span>&lt;span class="nb">{&lt;/span>#2&lt;span class="nb">}&lt;/span>&lt;span class="k">\hspace&lt;/span>&lt;span class="nb">{&lt;/span>3pt&lt;span class="nb">}&lt;/span>#4&lt;span class="nb">}}}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>Moreover, in order to support Chinese, the code below should be added&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-latex" data-lang="latex">&lt;span class="line">&lt;span class="cl">&lt;span class="k">\usepackage&lt;/span>&lt;span class="nb">{&lt;/span>xeCJK&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">\setCJKmainfont&lt;/span>&lt;span class="nb">{&lt;/span>SimSun&lt;span class="nb">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>Now that custom files are used, the command is&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">jupyter nbconvert --to pdf --template-file assignment filename.ipynb&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>The complete file is shown as follows:&lt;/p>
&lt;ol>
&lt;li>assignment.tex.j2&lt;/li>
&lt;/ol>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-latex" data-lang="latex">&lt;span class="line">&lt;span class="cl">&lt;span class="c">% Default to the notebook output style
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span>((* if not cell&lt;span class="nb">_&lt;/span>style is defined *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((* set cell&lt;span class="nb">_&lt;/span>style = &amp;#39;style&lt;span class="nb">_&lt;/span>assignment.tex.j2&amp;#39; *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((* endif *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">% Inherit from the specified cell style.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span>((* extends cell&lt;span class="nb">_&lt;/span>style *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">%===============================================================================
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">% Latex Book
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">%===============================================================================
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((* block predoc *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((( super() )))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((* block tableofcontents *))&lt;span class="k">\tableofcontents&lt;/span>((* endblock tableofcontents *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((* endblock predoc *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((* block docclass *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">\documentclass&lt;/span>&lt;span class="nb">{&lt;/span>report&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((* endblock docclass *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((* block markdowncell scoped *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((( cell.source | citation2latex | strip&lt;span class="nb">_&lt;/span>files&lt;span class="nb">_&lt;/span>prefix | convert&lt;span class="nb">_&lt;/span>pandoc(&amp;#39;markdown+tex&lt;span class="nb">_&lt;/span>math&lt;span class="nb">_&lt;/span>double&lt;span class="nb">_&lt;/span>backslash&amp;#39;, &amp;#39;json&amp;#39;,extra&lt;span class="nb">_&lt;/span>args=[]) | resolve&lt;span class="nb">_&lt;/span>references | convert&lt;span class="nb">_&lt;/span>pandoc(&amp;#39;json&amp;#39;,&amp;#39;latex&amp;#39;, extra&lt;span class="nb">_&lt;/span>args=[&amp;#34;--top-level-division=chapter&amp;#34;]) )))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((* endblock markdowncell *))&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;ol start="2">
&lt;li>style_assignment.tex.j2&lt;/li>
&lt;/ol>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;span class="lnt">174
&lt;/span>&lt;span class="lnt">175
&lt;/span>&lt;span class="lnt">176
&lt;/span>&lt;span class="lnt">177
&lt;/span>&lt;span class="lnt">178
&lt;/span>&lt;span class="lnt">179
&lt;/span>&lt;span class="lnt">180
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-latex" data-lang="latex">&lt;span class="line">&lt;span class="cl">((=- IPython input/output style -=))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- extends &amp;#39;base.tex.j2&amp;#39; -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- block packages -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\usepackage&lt;/span>&lt;span class="nb">{&lt;/span>xeCJK&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\setCJKmainfont&lt;/span>&lt;span class="nb">{&lt;/span>SimSun&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\usepackage&lt;/span>&lt;span class="na">[breakable]&lt;/span>&lt;span class="nb">{&lt;/span>tcolorbox&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\usepackage&lt;/span>&lt;span class="nb">{&lt;/span>parskip&lt;span class="nb">}&lt;/span> &lt;span class="c">% Stop auto-indenting (to mimic markdown behaviour)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> ((( super() )))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- endblock packages -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- block definitions -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((( super() )))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">% Pygments definitions
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> (((- resources.latex.pygments&lt;span class="nb">_&lt;/span>definitions )))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">% For linebreaks inside Verbatim environment from package fancyvrb.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\makeatletter&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\newbox\Wrappedcontinuationbox&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\newbox\Wrappedvisiblespacebox&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\newcommand*\Wrappedvisiblespace&lt;/span> &lt;span class="nb">{&lt;/span>&lt;span class="k">\textcolor&lt;/span>&lt;span class="nb">{&lt;/span>red&lt;span class="nb">}{&lt;/span>&lt;span class="k">\textvisiblespace&lt;/span>&lt;span class="nb">}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\newcommand*\Wrappedcontinuationsymbol&lt;/span> &lt;span class="nb">{&lt;/span>&lt;span class="k">\textcolor&lt;/span>&lt;span class="nb">{&lt;/span>red&lt;span class="nb">}{&lt;/span>&lt;span class="k">\llap&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\tiny&lt;/span>&lt;span class="s">$&lt;/span>&lt;span class="nv">\m&lt;/span>&lt;span class="nb">@th&lt;/span>&lt;span class="nv">\hookrightarrow&lt;/span>&lt;span class="s">$&lt;/span>&lt;span class="nb">}}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\newcommand*\Wrappedcontinuationindent&lt;/span> &lt;span class="nb">{&lt;/span>3ex &lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\newcommand*\Wrappedafterbreak&lt;/span> &lt;span class="nb">{&lt;/span>&lt;span class="k">\kern\Wrappedcontinuationindent\copy\Wrappedcontinuationbox&lt;/span>&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">% Take advantage of the already applied Pygments mark-up to insert
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="c">% potential linebreaks for TeX processing.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="c">% {, &amp;lt;, #, %, $, &amp;#39; and &amp;#34;: go to next line.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="c">% _, }, ^, &amp;amp;, &amp;gt;, - and ~: stay at end of broken line.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="c">% Use of \textquotesingle for straight quote.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\newcommand*\Wrappedbreaksatspecials&lt;/span> &lt;span class="nb">{&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZus&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\_&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\_&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZob&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{}{&lt;/span>&lt;span class="k">\Wrappedafterbreak\char&lt;/span>`&lt;span class="k">\{&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\{&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZcb&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\}&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\}&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZca&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\^&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\^&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZam&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\&amp;amp;&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\&amp;amp;&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZlt&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{}{&lt;/span>&lt;span class="k">\Wrappedafterbreak\char&lt;/span>`&lt;span class="k">\&amp;lt;&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\&amp;lt;&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZgt&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\&amp;gt;&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\&amp;gt;&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZsh&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{}{&lt;/span>&lt;span class="k">\Wrappedafterbreak\char&lt;/span>`&lt;span class="k">\#&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\#&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZpc&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{}{&lt;/span>&lt;span class="k">\Wrappedafterbreak\char&lt;/span>`&lt;span class="k">\%&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\%&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZdl&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{}{&lt;/span>&lt;span class="k">\Wrappedafterbreak\char&lt;/span>`&lt;span class="k">\$&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\$&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZhy&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\-&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\-&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZsq&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{}{&lt;/span>&lt;span class="k">\Wrappedafterbreak\textquotesingle&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\textquotesingle&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZdq&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{}{&lt;/span>&lt;span class="k">\Wrappedafterbreak\char&lt;/span>`&lt;span class="k">\&amp;#34;&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\&amp;#34;&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZti&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\~&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\~&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">% Some characters . , ; ? ! / are not pygmentized.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="c">% This macro makes them &amp;#34;active&amp;#34; and they will insert potential linebreaks
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\newcommand*\Wrappedbreaksatpunct&lt;/span> &lt;span class="nb">{&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\lccode&lt;/span>`&lt;span class="k">\~&lt;/span>`&lt;span class="k">\.\lowercase&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\def&lt;/span>~&lt;span class="nb">}{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\.&lt;/span>&lt;span class="nb">}}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\.&lt;/span>&lt;span class="nb">}}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\lccode&lt;/span>`&lt;span class="k">\~&lt;/span>`&lt;span class="k">\,\lowercase&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\def&lt;/span>~&lt;span class="nb">}{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\,&lt;/span>&lt;span class="nb">}}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\,&lt;/span>&lt;span class="nb">}}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\lccode&lt;/span>`&lt;span class="k">\~&lt;/span>`&lt;span class="k">\;\lowercase&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\def&lt;/span>~&lt;span class="nb">}{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\;&lt;/span>&lt;span class="nb">}}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\;&lt;/span>&lt;span class="nb">}}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\lccode&lt;/span>`&lt;span class="k">\~&lt;/span>`&lt;span class="k">\:\lowercase&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\def&lt;/span>~&lt;span class="nb">}{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\:&lt;/span>&lt;span class="nb">}}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\:&lt;/span>&lt;span class="nb">}}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\lccode&lt;/span>`&lt;span class="k">\~&lt;/span>`&lt;span class="k">\?\lowercase&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\def&lt;/span>~&lt;span class="nb">}{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\?&lt;/span>&lt;span class="nb">}}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\?&lt;/span>&lt;span class="nb">}}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\lccode&lt;/span>`&lt;span class="k">\~&lt;/span>`&lt;span class="k">\!\lowercase&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\def&lt;/span>~&lt;span class="nb">}{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\!&lt;/span>&lt;span class="nb">}}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\!&lt;/span>&lt;span class="nb">}}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\lccode&lt;/span>`&lt;span class="k">\~&lt;/span>`&lt;span class="k">\/\lowercase&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\def&lt;/span>~&lt;span class="nb">}{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\/&lt;/span>&lt;span class="nb">}}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\/&lt;/span>&lt;span class="nb">}}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\catcode&lt;/span>`&lt;span class="k">\.\active&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\catcode&lt;/span>`&lt;span class="k">\,\active&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\catcode&lt;/span>`&lt;span class="k">\;\active&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\catcode&lt;/span>`&lt;span class="k">\:\active&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\catcode&lt;/span>`&lt;span class="k">\?\active&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\catcode&lt;/span>`&lt;span class="k">\!\active&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\catcode&lt;/span>`&lt;span class="k">\/\active&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\lccode&lt;/span>`&lt;span class="k">\~&lt;/span>`&lt;span class="k">\~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\makeatother&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\let\OriginalVerbatim&lt;/span>=&lt;span class="k">\Verbatim&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\makeatletter&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\renewcommand&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\Verbatim&lt;/span>&lt;span class="nb">}&lt;/span>[1][1]&lt;span class="nb">{&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="c">%\parskip\z@skip
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\sbox\Wrappedcontinuationbox&lt;/span> &lt;span class="nb">{&lt;/span>&lt;span class="k">\Wrappedcontinuationsymbol&lt;/span>&lt;span class="nb">}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\sbox\Wrappedvisiblespacebox&lt;/span> &lt;span class="nb">{&lt;/span>&lt;span class="k">\FV&lt;/span>@SetupFont&lt;span class="k">\Wrappedvisiblespace&lt;/span>&lt;span class="nb">}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\FancyVerbFormatLine&lt;/span> ##1&lt;span class="nb">{&lt;/span>&lt;span class="k">\hsize\linewidth&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\vtop&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\raggedright\hyphenpenalty\z&lt;/span>@&lt;span class="k">\exhyphenpenalty\z&lt;/span>@
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\doublehyphendemerits\z&lt;/span>@&lt;span class="k">\finalhyphendemerits\z&lt;/span>@
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\strut&lt;/span> ##1&lt;span class="k">\strut&lt;/span>&lt;span class="nb">}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="nb">}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="c">% If the linebreak is at a space, the latter will be displayed as visible
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="c">% space at end of first line, and a continuation symbol starts next line.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="c">% Stretch/shrink are however usually zero for typewriter font.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\FV&lt;/span>@Space &lt;span class="nb">{&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\nobreak\hskip\z&lt;/span>@ plus&lt;span class="k">\fontdimen&lt;/span>3&lt;span class="k">\font&lt;/span> minus&lt;span class="k">\fontdimen&lt;/span>4&lt;span class="k">\font&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\copy\Wrappedvisiblespacebox&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">{&lt;/span>&lt;span class="k">\kern\fontdimen&lt;/span>2&lt;span class="k">\font&lt;/span>&lt;span class="nb">}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="nb">}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">% Allow breaks at special characters using \PYG... macros.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\Wrappedbreaksatspecials&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">% Breaks at punctuation characters . , ; ? ! and / need catcode=\active
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\OriginalVerbatim&lt;/span>&lt;span class="na">[#1,codes*=\Wrappedbreaksatpunct]&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\makeatother&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">% Exact colors from NB
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> ((*- block style&lt;span class="nb">_&lt;/span>colors *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\definecolor&lt;/span>&lt;span class="nb">{&lt;/span>incolor&lt;span class="nb">}{&lt;/span>HTML&lt;span class="nb">}{&lt;/span>303F9F&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\definecolor&lt;/span>&lt;span class="nb">{&lt;/span>outcolor&lt;span class="nb">}{&lt;/span>HTML&lt;span class="nb">}{&lt;/span>D84315&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\definecolor&lt;/span>&lt;span class="nb">{&lt;/span>cellborder&lt;span class="nb">}{&lt;/span>HTML&lt;span class="nb">}{&lt;/span>CFCFCF&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\definecolor&lt;/span>&lt;span class="nb">{&lt;/span>cellbackground&lt;span class="nb">}{&lt;/span>HTML&lt;span class="nb">}{&lt;/span>F7F7F7&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((*- endblock style&lt;span class="nb">_&lt;/span>colors *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">% prompt
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\makeatletter&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\newcommand&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\boxspacing&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\kern\kvtcb&lt;/span>@left@rule&lt;span class="k">\kern\kvtcb&lt;/span>@boxsep&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\makeatother&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((*- block style&lt;span class="nb">_&lt;/span>prompt *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\newcommand&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\prompt&lt;/span>&lt;span class="nb">}&lt;/span>[4]&lt;span class="nb">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">{&lt;/span>&lt;span class="k">\ttfamily\llap&lt;/span>&lt;span class="nb">{{&lt;/span>&lt;span class="k">\color&lt;/span>&lt;span class="nb">{&lt;/span>#2&lt;span class="nb">}&lt;/span>&lt;span class="k">\hspace&lt;/span>&lt;span class="nb">{&lt;/span>3pt&lt;span class="nb">}&lt;/span>#4&lt;span class="nb">}}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((* endblock style&lt;span class="nb">_&lt;/span>prompt *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- endblock definitions -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">%===============================================================================
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">% Input
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">%===============================================================================
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((* block input scoped *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((( draw&lt;span class="nb">_&lt;/span>cell(cell.source | highlight&lt;span class="nb">_&lt;/span>code(strip&lt;span class="nb">_&lt;/span>verbatim=True), cell, &amp;#39;In&amp;#39;, &amp;#39;incolor&amp;#39;, &amp;#39;&lt;span class="k">\\&lt;/span>boxspacing&amp;#39;) )))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((* endblock input *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">%===============================================================================
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">% Output
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">%===============================================================================
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- if charlim is not defined -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((* set charlim = 80 *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- endif -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((* block execute&lt;span class="nb">_&lt;/span>result scoped *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((*- for type in output.data | filter&lt;span class="nb">_&lt;/span>data&lt;span class="nb">_&lt;/span>type -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((*- if type in [&amp;#39;text/plain&amp;#39;]*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((( draw&lt;span class="nb">_&lt;/span>cell(output.data[&amp;#39;text/plain&amp;#39;] | wrap&lt;span class="nb">_&lt;/span>text(charlim) | escape&lt;span class="nb">_&lt;/span>latex | ansi2latex, cell, &amp;#39;Out&amp;#39;, &amp;#39;outcolor&amp;#39;, &amp;#39;&lt;span class="k">\\&lt;/span>boxspacing&amp;#39;) )))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((* else -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((( &amp;#34; &amp;#34; )))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((( draw&lt;span class="nb">_&lt;/span>prompt(cell, &amp;#39;Out&amp;#39;, &amp;#39;outcolor&amp;#39;,&amp;#39;&amp;#39;) )))((( super() )))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((*- endif -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((*- endfor -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((* endblock execute&lt;span class="nb">_&lt;/span>result *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((* block stream *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\begin&lt;/span>&lt;span class="nb">{&lt;/span>Verbatim&lt;span class="nb">}&lt;/span>[commandchars=&lt;span class="k">\\\{\}&lt;/span>]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((( output.text | wrap&lt;span class="nb">_&lt;/span>text(charlim) | escape&lt;span class="nb">_&lt;/span>latex | strip&lt;span class="nb">_&lt;/span>trailing&lt;span class="nb">_&lt;/span>newline | ansi2latex )))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\end&lt;/span>&lt;span class="nb">{&lt;/span>Verbatim&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((* endblock stream *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">%==============================================================================
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">% Support Macros
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">%==============================================================================
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">% Name: draw_cell
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">% Purpose: Renders an output/input prompt
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span>((*- if draw&lt;span class="nb">_&lt;/span>cell is not defined -*)) &lt;span class="c">% Required to allow overriding.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span>((* macro draw&lt;span class="nb">_&lt;/span>cell(text, cell, prompt, prompt&lt;span class="nb">_&lt;/span>color, extra&lt;span class="nb">_&lt;/span>space) -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- if prompt == &amp;#39;In&amp;#39; -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- set style = &amp;#34;breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder&amp;#34;-*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- else -*))((*- set style = &amp;#34;breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0&amp;#34;-*))((*- endif -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">\begin&lt;/span>&lt;span class="nb">{&lt;/span>tcolorbox&lt;span class="nb">}&lt;/span>[((( style )))]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(((- draw&lt;span class="nb">_&lt;/span>prompt(cell, prompt, prompt&lt;span class="nb">_&lt;/span>color, extra&lt;span class="nb">_&lt;/span>space) )))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">\begin&lt;/span>&lt;span class="nb">{&lt;/span>Verbatim&lt;span class="nb">}&lt;/span>[commandchars=&lt;span class="k">\\\{\}&lt;/span>]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((( text )))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">\end&lt;/span>&lt;span class="nb">{&lt;/span>Verbatim&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">\end&lt;/span>&lt;span class="nb">{&lt;/span>tcolorbox&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- endmacro *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- endif -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">% Name: draw_prompt
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">% Purpose: Renders an output/input prompt
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span>((* macro draw&lt;span class="nb">_&lt;/span>prompt(cell, prompt, prompt&lt;span class="nb">_&lt;/span>color, extra&lt;span class="nb">_&lt;/span>space) -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((*- if cell.execution&lt;span class="nb">_&lt;/span>count is defined -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((*- set execution&lt;span class="nb">_&lt;/span>count = &amp;#34;&amp;#34; ~ (cell.execution&lt;span class="nb">_&lt;/span>count | replace(None, &amp;#34; &amp;#34;)) -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((*- else -*))((*- set execution&lt;span class="nb">_&lt;/span>count = &amp;#34; &amp;#34; -*))((*- endif *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((*- if (resources.global&lt;span class="nb">_&lt;/span>content&lt;span class="nb">_&lt;/span>filter.include&lt;span class="nb">_&lt;/span>output&lt;span class="nb">_&lt;/span>prompt and prompt == &amp;#39;Out&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> or (resources.global&lt;span class="nb">_&lt;/span>content&lt;span class="nb">_&lt;/span>filter.include&lt;span class="nb">_&lt;/span>input&lt;span class="nb">_&lt;/span>prompt and prompt == &amp;#39;In&amp;#39; ) *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">\prompt&lt;/span>&lt;span class="nb">{&lt;/span>(((prompt)))&lt;span class="nb">}{&lt;/span>(((prompt&lt;span class="nb">_&lt;/span>color)))&lt;span class="nb">}{&lt;/span>(((execution&lt;span class="nb">_&lt;/span>count)))&lt;span class="nb">}{&lt;/span>(((extra&lt;span class="nb">_&lt;/span>space)))&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((*- endif -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- endmacro *))&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>Furthermore, if you want to hide code:&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt"> 10
&lt;/span>&lt;span class="lnt"> 11
&lt;/span>&lt;span class="lnt"> 12
&lt;/span>&lt;span class="lnt"> 13
&lt;/span>&lt;span class="lnt"> 14
&lt;/span>&lt;span class="lnt"> 15
&lt;/span>&lt;span class="lnt"> 16
&lt;/span>&lt;span class="lnt"> 17
&lt;/span>&lt;span class="lnt"> 18
&lt;/span>&lt;span class="lnt"> 19
&lt;/span>&lt;span class="lnt"> 20
&lt;/span>&lt;span class="lnt"> 21
&lt;/span>&lt;span class="lnt"> 22
&lt;/span>&lt;span class="lnt"> 23
&lt;/span>&lt;span class="lnt"> 24
&lt;/span>&lt;span class="lnt"> 25
&lt;/span>&lt;span class="lnt"> 26
&lt;/span>&lt;span class="lnt"> 27
&lt;/span>&lt;span class="lnt"> 28
&lt;/span>&lt;span class="lnt"> 29
&lt;/span>&lt;span class="lnt"> 30
&lt;/span>&lt;span class="lnt"> 31
&lt;/span>&lt;span class="lnt"> 32
&lt;/span>&lt;span class="lnt"> 33
&lt;/span>&lt;span class="lnt"> 34
&lt;/span>&lt;span class="lnt"> 35
&lt;/span>&lt;span class="lnt"> 36
&lt;/span>&lt;span class="lnt"> 37
&lt;/span>&lt;span class="lnt"> 38
&lt;/span>&lt;span class="lnt"> 39
&lt;/span>&lt;span class="lnt"> 40
&lt;/span>&lt;span class="lnt"> 41
&lt;/span>&lt;span class="lnt"> 42
&lt;/span>&lt;span class="lnt"> 43
&lt;/span>&lt;span class="lnt"> 44
&lt;/span>&lt;span class="lnt"> 45
&lt;/span>&lt;span class="lnt"> 46
&lt;/span>&lt;span class="lnt"> 47
&lt;/span>&lt;span class="lnt"> 48
&lt;/span>&lt;span class="lnt"> 49
&lt;/span>&lt;span class="lnt"> 50
&lt;/span>&lt;span class="lnt"> 51
&lt;/span>&lt;span class="lnt"> 52
&lt;/span>&lt;span class="lnt"> 53
&lt;/span>&lt;span class="lnt"> 54
&lt;/span>&lt;span class="lnt"> 55
&lt;/span>&lt;span class="lnt"> 56
&lt;/span>&lt;span class="lnt"> 57
&lt;/span>&lt;span class="lnt"> 58
&lt;/span>&lt;span class="lnt"> 59
&lt;/span>&lt;span class="lnt"> 60
&lt;/span>&lt;span class="lnt"> 61
&lt;/span>&lt;span class="lnt"> 62
&lt;/span>&lt;span class="lnt"> 63
&lt;/span>&lt;span class="lnt"> 64
&lt;/span>&lt;span class="lnt"> 65
&lt;/span>&lt;span class="lnt"> 66
&lt;/span>&lt;span class="lnt"> 67
&lt;/span>&lt;span class="lnt"> 68
&lt;/span>&lt;span class="lnt"> 69
&lt;/span>&lt;span class="lnt"> 70
&lt;/span>&lt;span class="lnt"> 71
&lt;/span>&lt;span class="lnt"> 72
&lt;/span>&lt;span class="lnt"> 73
&lt;/span>&lt;span class="lnt"> 74
&lt;/span>&lt;span class="lnt"> 75
&lt;/span>&lt;span class="lnt"> 76
&lt;/span>&lt;span class="lnt"> 77
&lt;/span>&lt;span class="lnt"> 78
&lt;/span>&lt;span class="lnt"> 79
&lt;/span>&lt;span class="lnt"> 80
&lt;/span>&lt;span class="lnt"> 81
&lt;/span>&lt;span class="lnt"> 82
&lt;/span>&lt;span class="lnt"> 83
&lt;/span>&lt;span class="lnt"> 84
&lt;/span>&lt;span class="lnt"> 85
&lt;/span>&lt;span class="lnt"> 86
&lt;/span>&lt;span class="lnt"> 87
&lt;/span>&lt;span class="lnt"> 88
&lt;/span>&lt;span class="lnt"> 89
&lt;/span>&lt;span class="lnt"> 90
&lt;/span>&lt;span class="lnt"> 91
&lt;/span>&lt;span class="lnt"> 92
&lt;/span>&lt;span class="lnt"> 93
&lt;/span>&lt;span class="lnt"> 94
&lt;/span>&lt;span class="lnt"> 95
&lt;/span>&lt;span class="lnt"> 96
&lt;/span>&lt;span class="lnt"> 97
&lt;/span>&lt;span class="lnt"> 98
&lt;/span>&lt;span class="lnt"> 99
&lt;/span>&lt;span class="lnt">100
&lt;/span>&lt;span class="lnt">101
&lt;/span>&lt;span class="lnt">102
&lt;/span>&lt;span class="lnt">103
&lt;/span>&lt;span class="lnt">104
&lt;/span>&lt;span class="lnt">105
&lt;/span>&lt;span class="lnt">106
&lt;/span>&lt;span class="lnt">107
&lt;/span>&lt;span class="lnt">108
&lt;/span>&lt;span class="lnt">109
&lt;/span>&lt;span class="lnt">110
&lt;/span>&lt;span class="lnt">111
&lt;/span>&lt;span class="lnt">112
&lt;/span>&lt;span class="lnt">113
&lt;/span>&lt;span class="lnt">114
&lt;/span>&lt;span class="lnt">115
&lt;/span>&lt;span class="lnt">116
&lt;/span>&lt;span class="lnt">117
&lt;/span>&lt;span class="lnt">118
&lt;/span>&lt;span class="lnt">119
&lt;/span>&lt;span class="lnt">120
&lt;/span>&lt;span class="lnt">121
&lt;/span>&lt;span class="lnt">122
&lt;/span>&lt;span class="lnt">123
&lt;/span>&lt;span class="lnt">124
&lt;/span>&lt;span class="lnt">125
&lt;/span>&lt;span class="lnt">126
&lt;/span>&lt;span class="lnt">127
&lt;/span>&lt;span class="lnt">128
&lt;/span>&lt;span class="lnt">129
&lt;/span>&lt;span class="lnt">130
&lt;/span>&lt;span class="lnt">131
&lt;/span>&lt;span class="lnt">132
&lt;/span>&lt;span class="lnt">133
&lt;/span>&lt;span class="lnt">134
&lt;/span>&lt;span class="lnt">135
&lt;/span>&lt;span class="lnt">136
&lt;/span>&lt;span class="lnt">137
&lt;/span>&lt;span class="lnt">138
&lt;/span>&lt;span class="lnt">139
&lt;/span>&lt;span class="lnt">140
&lt;/span>&lt;span class="lnt">141
&lt;/span>&lt;span class="lnt">142
&lt;/span>&lt;span class="lnt">143
&lt;/span>&lt;span class="lnt">144
&lt;/span>&lt;span class="lnt">145
&lt;/span>&lt;span class="lnt">146
&lt;/span>&lt;span class="lnt">147
&lt;/span>&lt;span class="lnt">148
&lt;/span>&lt;span class="lnt">149
&lt;/span>&lt;span class="lnt">150
&lt;/span>&lt;span class="lnt">151
&lt;/span>&lt;span class="lnt">152
&lt;/span>&lt;span class="lnt">153
&lt;/span>&lt;span class="lnt">154
&lt;/span>&lt;span class="lnt">155
&lt;/span>&lt;span class="lnt">156
&lt;/span>&lt;span class="lnt">157
&lt;/span>&lt;span class="lnt">158
&lt;/span>&lt;span class="lnt">159
&lt;/span>&lt;span class="lnt">160
&lt;/span>&lt;span class="lnt">161
&lt;/span>&lt;span class="lnt">162
&lt;/span>&lt;span class="lnt">163
&lt;/span>&lt;span class="lnt">164
&lt;/span>&lt;span class="lnt">165
&lt;/span>&lt;span class="lnt">166
&lt;/span>&lt;span class="lnt">167
&lt;/span>&lt;span class="lnt">168
&lt;/span>&lt;span class="lnt">169
&lt;/span>&lt;span class="lnt">170
&lt;/span>&lt;span class="lnt">171
&lt;/span>&lt;span class="lnt">172
&lt;/span>&lt;span class="lnt">173
&lt;/span>&lt;span class="lnt">174
&lt;/span>&lt;span class="lnt">175
&lt;/span>&lt;span class="lnt">176
&lt;/span>&lt;span class="lnt">177
&lt;/span>&lt;span class="lnt">178
&lt;/span>&lt;span class="lnt">179
&lt;/span>&lt;span class="lnt">180
&lt;/span>&lt;span class="lnt">181
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-latex" data-lang="latex">&lt;span class="line">&lt;span class="cl">((=- IPython input/output style -=))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- extends &amp;#39;base.tex.j2&amp;#39; -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- block packages -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\usepackage&lt;/span>&lt;span class="nb">{&lt;/span>xeCJK&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\setCJKmainfont&lt;/span>&lt;span class="nb">{&lt;/span>SimSun&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\usepackage&lt;/span>&lt;span class="na">[breakable]&lt;/span>&lt;span class="nb">{&lt;/span>tcolorbox&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\usepackage&lt;/span>&lt;span class="nb">{&lt;/span>parskip&lt;span class="nb">}&lt;/span> &lt;span class="c">% Stop auto-indenting (to mimic markdown behaviour)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> ((( super() )))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- endblock packages -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- block definitions -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((( super() )))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">% Pygments definitions
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> (((- resources.latex.pygments&lt;span class="nb">_&lt;/span>definitions )))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">% For linebreaks inside Verbatim environment from package fancyvrb.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\makeatletter&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\newbox\Wrappedcontinuationbox&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\newbox\Wrappedvisiblespacebox&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\newcommand*\Wrappedvisiblespace&lt;/span> &lt;span class="nb">{&lt;/span>&lt;span class="k">\textcolor&lt;/span>&lt;span class="nb">{&lt;/span>red&lt;span class="nb">}{&lt;/span>&lt;span class="k">\textvisiblespace&lt;/span>&lt;span class="nb">}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\newcommand*\Wrappedcontinuationsymbol&lt;/span> &lt;span class="nb">{&lt;/span>&lt;span class="k">\textcolor&lt;/span>&lt;span class="nb">{&lt;/span>red&lt;span class="nb">}{&lt;/span>&lt;span class="k">\llap&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\tiny&lt;/span>&lt;span class="s">$&lt;/span>&lt;span class="nv">\m&lt;/span>&lt;span class="nb">@th&lt;/span>&lt;span class="nv">\hookrightarrow&lt;/span>&lt;span class="s">$&lt;/span>&lt;span class="nb">}}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\newcommand*\Wrappedcontinuationindent&lt;/span> &lt;span class="nb">{&lt;/span>3ex &lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\newcommand*\Wrappedafterbreak&lt;/span> &lt;span class="nb">{&lt;/span>&lt;span class="k">\kern\Wrappedcontinuationindent\copy\Wrappedcontinuationbox&lt;/span>&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">% Take advantage of the already applied Pygments mark-up to insert
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="c">% potential linebreaks for TeX processing.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="c">% {, &amp;lt;, #, %, $, &amp;#39; and &amp;#34;: go to next line.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="c">% _, }, ^, &amp;amp;, &amp;gt;, - and ~: stay at end of broken line.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="c">% Use of \textquotesingle for straight quote.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\newcommand*\Wrappedbreaksatspecials&lt;/span> &lt;span class="nb">{&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZus&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\_&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\_&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZob&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{}{&lt;/span>&lt;span class="k">\Wrappedafterbreak\char&lt;/span>`&lt;span class="k">\{&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\{&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZcb&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\}&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\}&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZca&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\^&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\^&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZam&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\&amp;amp;&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\&amp;amp;&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZlt&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{}{&lt;/span>&lt;span class="k">\Wrappedafterbreak\char&lt;/span>`&lt;span class="k">\&amp;lt;&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\&amp;lt;&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZgt&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\&amp;gt;&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\&amp;gt;&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZsh&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{}{&lt;/span>&lt;span class="k">\Wrappedafterbreak\char&lt;/span>`&lt;span class="k">\#&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\#&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZpc&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{}{&lt;/span>&lt;span class="k">\Wrappedafterbreak\char&lt;/span>`&lt;span class="k">\%&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\%&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZdl&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{}{&lt;/span>&lt;span class="k">\Wrappedafterbreak\char&lt;/span>`&lt;span class="k">\$&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\$&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZhy&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\-&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\-&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZsq&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{}{&lt;/span>&lt;span class="k">\Wrappedafterbreak\textquotesingle&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\textquotesingle&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZdq&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{}{&lt;/span>&lt;span class="k">\Wrappedafterbreak\char&lt;/span>`&lt;span class="k">\&amp;#34;&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\&amp;#34;&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\PYGZti&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\~&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\~&lt;/span>&lt;span class="nb">}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">% Some characters . , ; ? ! / are not pygmentized.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="c">% This macro makes them &amp;#34;active&amp;#34; and they will insert potential linebreaks
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\newcommand*\Wrappedbreaksatpunct&lt;/span> &lt;span class="nb">{&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\lccode&lt;/span>`&lt;span class="k">\~&lt;/span>`&lt;span class="k">\.\lowercase&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\def&lt;/span>~&lt;span class="nb">}{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\.&lt;/span>&lt;span class="nb">}}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\.&lt;/span>&lt;span class="nb">}}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\lccode&lt;/span>`&lt;span class="k">\~&lt;/span>`&lt;span class="k">\,\lowercase&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\def&lt;/span>~&lt;span class="nb">}{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\,&lt;/span>&lt;span class="nb">}}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\,&lt;/span>&lt;span class="nb">}}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\lccode&lt;/span>`&lt;span class="k">\~&lt;/span>`&lt;span class="k">\;\lowercase&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\def&lt;/span>~&lt;span class="nb">}{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\;&lt;/span>&lt;span class="nb">}}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\;&lt;/span>&lt;span class="nb">}}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\lccode&lt;/span>`&lt;span class="k">\~&lt;/span>`&lt;span class="k">\:\lowercase&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\def&lt;/span>~&lt;span class="nb">}{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\:&lt;/span>&lt;span class="nb">}}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\:&lt;/span>&lt;span class="nb">}}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\lccode&lt;/span>`&lt;span class="k">\~&lt;/span>`&lt;span class="k">\?\lowercase&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\def&lt;/span>~&lt;span class="nb">}{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\?&lt;/span>&lt;span class="nb">}}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\?&lt;/span>&lt;span class="nb">}}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\lccode&lt;/span>`&lt;span class="k">\~&lt;/span>`&lt;span class="k">\!\lowercase&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\def&lt;/span>~&lt;span class="nb">}{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\!&lt;/span>&lt;span class="nb">}}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\!&lt;/span>&lt;span class="nb">}}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\lccode&lt;/span>`&lt;span class="k">\~&lt;/span>`&lt;span class="k">\/\lowercase&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\def&lt;/span>~&lt;span class="nb">}{&lt;/span>&lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\/&lt;/span>&lt;span class="nb">}}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\hbox&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\char&lt;/span>`&lt;span class="k">\/&lt;/span>&lt;span class="nb">}}}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\catcode&lt;/span>`&lt;span class="k">\.\active&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\catcode&lt;/span>`&lt;span class="k">\,\active&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\catcode&lt;/span>`&lt;span class="k">\;\active&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\catcode&lt;/span>`&lt;span class="k">\:\active&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\catcode&lt;/span>`&lt;span class="k">\?\active&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\catcode&lt;/span>`&lt;span class="k">\!\active&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\catcode&lt;/span>`&lt;span class="k">\/\active&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\lccode&lt;/span>`&lt;span class="k">\~&lt;/span>`&lt;span class="k">\~&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\makeatother&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\let\OriginalVerbatim&lt;/span>=&lt;span class="k">\Verbatim&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\makeatletter&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\renewcommand&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\Verbatim&lt;/span>&lt;span class="nb">}&lt;/span>[1][1]&lt;span class="nb">{&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="c">%\parskip\z@skip
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\sbox\Wrappedcontinuationbox&lt;/span> &lt;span class="nb">{&lt;/span>&lt;span class="k">\Wrappedcontinuationsymbol&lt;/span>&lt;span class="nb">}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\sbox\Wrappedvisiblespacebox&lt;/span> &lt;span class="nb">{&lt;/span>&lt;span class="k">\FV&lt;/span>@SetupFont&lt;span class="k">\Wrappedvisiblespace&lt;/span>&lt;span class="nb">}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\FancyVerbFormatLine&lt;/span> ##1&lt;span class="nb">{&lt;/span>&lt;span class="k">\hsize\linewidth&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\vtop&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\raggedright\hyphenpenalty\z&lt;/span>@&lt;span class="k">\exhyphenpenalty\z&lt;/span>@
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\doublehyphendemerits\z&lt;/span>@&lt;span class="k">\finalhyphendemerits\z&lt;/span>@
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\strut&lt;/span> ##1&lt;span class="k">\strut&lt;/span>&lt;span class="nb">}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="nb">}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="c">% If the linebreak is at a space, the latter will be displayed as visible
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="c">% space at end of first line, and a continuation symbol starts next line.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="c">% Stretch/shrink are however usually zero for typewriter font.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\def\FV&lt;/span>@Space &lt;span class="nb">{&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\nobreak\hskip\z&lt;/span>@ plus&lt;span class="k">\fontdimen&lt;/span>3&lt;span class="k">\font&lt;/span> minus&lt;span class="k">\fontdimen&lt;/span>4&lt;span class="k">\font&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\discretionary&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\copy\Wrappedvisiblespacebox&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\Wrappedafterbreak&lt;/span>&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">{&lt;/span>&lt;span class="k">\kern\fontdimen&lt;/span>2&lt;span class="k">\font&lt;/span>&lt;span class="nb">}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="nb">}&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">% Allow breaks at special characters using \PYG... macros.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\Wrappedbreaksatspecials&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">% Breaks at punctuation characters . , ; ? ! and / need catcode=\active
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\OriginalVerbatim&lt;/span>&lt;span class="na">[#1,codes*=\Wrappedbreaksatpunct]&lt;/span>&lt;span class="c">%
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\makeatother&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">% Exact colors from NB
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> ((*- block style&lt;span class="nb">_&lt;/span>colors *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\definecolor&lt;/span>&lt;span class="nb">{&lt;/span>incolor&lt;span class="nb">}{&lt;/span>HTML&lt;span class="nb">}{&lt;/span>303F9F&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\definecolor&lt;/span>&lt;span class="nb">{&lt;/span>outcolor&lt;span class="nb">}{&lt;/span>HTML&lt;span class="nb">}{&lt;/span>D84315&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\definecolor&lt;/span>&lt;span class="nb">{&lt;/span>cellborder&lt;span class="nb">}{&lt;/span>HTML&lt;span class="nb">}{&lt;/span>CFCFCF&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\definecolor&lt;/span>&lt;span class="nb">{&lt;/span>cellbackground&lt;span class="nb">}{&lt;/span>HTML&lt;span class="nb">}{&lt;/span>F7F7F7&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((*- endblock style&lt;span class="nb">_&lt;/span>colors *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">% prompt
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span> &lt;span class="k">\makeatletter&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\newcommand&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\boxspacing&lt;/span>&lt;span class="nb">}{&lt;/span>&lt;span class="k">\kern\kvtcb&lt;/span>@left@rule&lt;span class="k">\kern\kvtcb&lt;/span>@boxsep&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\makeatother&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((*- block style&lt;span class="nb">_&lt;/span>prompt *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\newcommand&lt;/span>&lt;span class="nb">{&lt;/span>&lt;span class="k">\prompt&lt;/span>&lt;span class="nb">}&lt;/span>[4]&lt;span class="nb">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">{&lt;/span>&lt;span class="k">\ttfamily\llap&lt;/span>&lt;span class="nb">{{&lt;/span>&lt;span class="k">\color&lt;/span>&lt;span class="nb">{&lt;/span>#2&lt;span class="nb">}&lt;/span>&lt;span class="k">\hspace&lt;/span>&lt;span class="nb">{&lt;/span>3pt&lt;span class="nb">}&lt;/span>#4&lt;span class="nb">}}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((* endblock style&lt;span class="nb">_&lt;/span>prompt *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- endblock definitions -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">%===============================================================================
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">% Input
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">%===============================================================================
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((* block input scoped *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c">% input hidden
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span>((* endblock input *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">%===============================================================================
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">% Output
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">%===============================================================================
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- if charlim is not defined -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((* set charlim = 80 *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- endif -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((* block execute&lt;span class="nb">_&lt;/span>result scoped *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((*- for type in output.data | filter&lt;span class="nb">_&lt;/span>data&lt;span class="nb">_&lt;/span>type -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((*- if type in [&amp;#39;text/plain&amp;#39;]*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((( draw&lt;span class="nb">_&lt;/span>cell(output.data[&amp;#39;text/plain&amp;#39;] | wrap&lt;span class="nb">_&lt;/span>text(charlim) | escape&lt;span class="nb">_&lt;/span>latex | ansi2latex, cell, &amp;#39;Out&amp;#39;, &amp;#39;outcolor&amp;#39;, &amp;#39;&lt;span class="k">\\&lt;/span>boxspacing&amp;#39;) )))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((* else -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((( &amp;#34; &amp;#34; )))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((( draw&lt;span class="nb">_&lt;/span>prompt(cell, &amp;#39;Out&amp;#39;, &amp;#39;outcolor&amp;#39;,&amp;#39;&amp;#39;) )))((( super() )))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((*- endif -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((*- endfor -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((* endblock execute&lt;span class="nb">_&lt;/span>result *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((* block stream *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\begin&lt;/span>&lt;span class="nb">{&lt;/span>Verbatim&lt;span class="nb">}&lt;/span>[commandchars=&lt;span class="k">\\\{\}&lt;/span>]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((( output.text | wrap&lt;span class="nb">_&lt;/span>text(charlim) | escape&lt;span class="nb">_&lt;/span>latex | strip&lt;span class="nb">_&lt;/span>trailing&lt;span class="nb">_&lt;/span>newline | ansi2latex )))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">\end&lt;/span>&lt;span class="nb">{&lt;/span>Verbatim&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((* endblock stream *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">%==============================================================================
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">% Support Macros
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">%==============================================================================
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">% Name: draw_cell
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">% Purpose: Renders an output/input prompt
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span>((*- if draw&lt;span class="nb">_&lt;/span>cell is not defined -*)) &lt;span class="c">% Required to allow overriding.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span>((* macro draw&lt;span class="nb">_&lt;/span>cell(text, cell, prompt, prompt&lt;span class="nb">_&lt;/span>color, extra&lt;span class="nb">_&lt;/span>space) -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- if prompt == &amp;#39;In&amp;#39; -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- set style = &amp;#34;breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder&amp;#34;-*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- else -*))((*- set style = &amp;#34;breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0&amp;#34;-*))((*- endif -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">\begin&lt;/span>&lt;span class="nb">{&lt;/span>tcolorbox&lt;span class="nb">}&lt;/span>[((( style )))]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">(((- draw&lt;span class="nb">_&lt;/span>prompt(cell, prompt, prompt&lt;span class="nb">_&lt;/span>color, extra&lt;span class="nb">_&lt;/span>space) )))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">\begin&lt;/span>&lt;span class="nb">{&lt;/span>Verbatim&lt;span class="nb">}&lt;/span>[commandchars=&lt;span class="k">\\\{\}&lt;/span>]
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((( text )))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">\end&lt;/span>&lt;span class="nb">{&lt;/span>Verbatim&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">\end&lt;/span>&lt;span class="nb">{&lt;/span>tcolorbox&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- endmacro *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- endif -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">% Name: draw_prompt
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">% Purpose: Renders an output/input prompt
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c">&lt;/span>((* macro draw&lt;span class="nb">_&lt;/span>prompt(cell, prompt, prompt&lt;span class="nb">_&lt;/span>color, extra&lt;span class="nb">_&lt;/span>space) -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((*- if cell.execution&lt;span class="nb">_&lt;/span>count is defined -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((*- set execution&lt;span class="nb">_&lt;/span>count = &amp;#34;&amp;#34; ~ (cell.execution&lt;span class="nb">_&lt;/span>count | replace(None, &amp;#34; &amp;#34;)) -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((*- else -*))((*- set execution&lt;span class="nb">_&lt;/span>count = &amp;#34; &amp;#34; -*))((*- endif *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((*- if (resources.global&lt;span class="nb">_&lt;/span>content&lt;span class="nb">_&lt;/span>filter.include&lt;span class="nb">_&lt;/span>output&lt;span class="nb">_&lt;/span>prompt and prompt == &amp;#39;Out&amp;#39;)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> or (resources.global&lt;span class="nb">_&lt;/span>content&lt;span class="nb">_&lt;/span>filter.include&lt;span class="nb">_&lt;/span>input&lt;span class="nb">_&lt;/span>prompt and prompt == &amp;#39;In&amp;#39; ) *))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">\prompt&lt;/span>&lt;span class="nb">{&lt;/span>(((prompt)))&lt;span class="nb">}{&lt;/span>(((prompt&lt;span class="nb">_&lt;/span>color)))&lt;span class="nb">}{&lt;/span>(((execution&lt;span class="nb">_&lt;/span>count)))&lt;span class="nb">}{&lt;/span>(((extra&lt;span class="nb">_&lt;/span>space)))&lt;span class="nb">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ((*- endif -*))
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">((*- endmacro *))&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script></description></item><item><title>Merge Anki Audios</title><link>https://chenkeao.github.io/post/merge-anki-audios/</link><pubDate>Fri, 13 Jun 2025 12:26:05 +0800</pubDate><guid>https://chenkeao.github.io/post/merge-anki-audios/</guid><description>&lt;ol>
&lt;li>exporting all selected notes with media references&lt;/li>
&lt;/ol>
&lt;img src="1.png" alt="" width="50%" style="display: block; margin: auto;"/>
&lt;ol start="2">
&lt;li>extract media paths from the exported file&lt;/li>
&lt;li>write a python script merging all selected audios into one&lt;/li>
&lt;/ol>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;span class="lnt">60
&lt;/span>&lt;span class="lnt">61
&lt;/span>&lt;span class="lnt">62
&lt;/span>&lt;span class="lnt">63
&lt;/span>&lt;span class="lnt">64
&lt;/span>&lt;span class="lnt">65
&lt;/span>&lt;span class="lnt">66
&lt;/span>&lt;span class="lnt">67
&lt;/span>&lt;span class="lnt">68
&lt;/span>&lt;span class="lnt">69
&lt;/span>&lt;span class="lnt">70
&lt;/span>&lt;span class="lnt">71
&lt;/span>&lt;span class="lnt">72
&lt;/span>&lt;span class="lnt">73
&lt;/span>&lt;span class="lnt">74
&lt;/span>&lt;span class="lnt">75
&lt;/span>&lt;span class="lnt">76
&lt;/span>&lt;span class="lnt">77
&lt;/span>&lt;span class="lnt">78
&lt;/span>&lt;span class="lnt">79
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">os&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">subprocess&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">pandas&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="nn">pd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">concurrent.futures&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">ThreadPoolExecutor&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">as_completed&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">tqdm&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">tqdm&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">random&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">AUDIO_DIRECTORY&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sa">r&lt;/span>&lt;span class="s2">&amp;#34;C:\Users\kyle\AppData\Roaming\Anki2\Eng\collection.media&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">SILENT&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sa">r&lt;/span>&lt;span class="s2">&amp;#34;C:\Users\momo\Home\Projects\Anki\silent.mp3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">list_file_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;../notes.txt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">df&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">pd&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">read_csv&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">list_file_path&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sep&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\t&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">header&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">None&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">names&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;word&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;lemma&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;context&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;sentence&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;examples&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;symbol&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;voc&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;def&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;word_sound&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;sentence_sound&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">],&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">word_audio_names&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">df&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;word_sound&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apply&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">lambda&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tolist&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">df&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;sentence_sound&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">df&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;sentence_sound&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">fillna&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">sentence_audio_names&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">df&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;sentence_sound&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">apply&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="k">lambda&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="n">x&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()[&lt;/span>&lt;span class="mi">7&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">])&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">tolist&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">audio_paths&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">AUDIO_DIRECTORY&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">item&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">item&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">word_audio_names&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">AUDIO_DIRECTORY&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">item&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">item&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">sentence_audio_names&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="n">item&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">normalize_audio&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">input_file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">output_file&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">try&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">command&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ffmpeg&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;-loglevel&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;quiet&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;-y&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;-i&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">input_file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;-ar&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;24000&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;-ab&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;96k&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">output_file&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">subprocess&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">command&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">check&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">output_file&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">except&lt;/span> &lt;span class="n">subprocess&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">CalledProcessError&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">e&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kc">None&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">normalize_audio_multithreaded&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file_list&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">output_dir&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">max_workers&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">16&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">exists&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">output_dir&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">makedirs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">output_dir&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;start normalizing audios&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="n">ThreadPoolExecutor&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">max_workers&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="n">max_workers&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">executor&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">futures&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">executor&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">submit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">normalize_audio&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">input_file&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">output_dir&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">basename&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">input_file&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">input_file&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">file_list&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">_&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">tqdm&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">as_completed&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">futures&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">total&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file_list&lt;/span>&lt;span class="p">)):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">print&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;files has prepared well&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">normalize_audio_multithreaded&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">audio_paths&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;temp&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">audio_paths&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[(&lt;/span>&lt;span class="n">w&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">w&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">s&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="nb">zip&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">word_audio_names&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">sentence_audio_names&lt;/span>&lt;span class="p">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">shuffle&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">audio_paths&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;file_list.txt&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;w&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">w&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">s&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">audio_paths&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;file &amp;#39;&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;temp&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">w&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;file silent.mp3&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;file &amp;#39;&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;temp&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">w&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;file silent.mp3&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">s&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;file &amp;#39;&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s1">&amp;#39;temp&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#39;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;file silent.mp3&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;file silent.mp3&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">command&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;ffmpeg&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;-y&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;-f&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;concat&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;-safe&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;0&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;-i&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;file_list.txt&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;-c&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;copy&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;output.mp3&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">subprocess&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">run&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">command&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">check&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="p">)&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script></description></item><item><title>Prune a Dictionary File(.mdx)</title><link>https://chenkeao.github.io/post/prune-a-dictionary-file.mdx/</link><pubDate>Fri, 13 Jun 2025 12:23:34 +0800</pubDate><guid>https://chenkeao.github.io/post/prune-a-dictionary-file.mdx/</guid><description>&lt;h2 id="introduction">Introduction
&lt;/h2>&lt;p>Dictionaries such as Oxford and Longman are used as the sources for the definitions in my flashcards. However, they sometimes contain too much unnecessary information, therefore making it unwieldy and grandiose, leading to a low loading speed and distractions. Since an MDX file utilizes the HTML format to save entries, which closely resembles the tree structure, I use the term &amp;ldquo;prune&amp;rdquo; to describe the course of removing branches, i.e. html nodes that contain superfluous elements. Each group of three lines in a mdx file constitutes an entry of a word where the first and the third lines are delimiters while the middle line is html content. Since typically MDX files are quite large, a division step is required for parallel processing. Thus, the breakdown procedures are as follows:&lt;/p>
&lt;ol>
&lt;li>split a gigantic mdx file into several small files. Note: the number of lines in each file must be a multiple of 3.&lt;/li>
&lt;li>process such files parallelly.&lt;/li>
&lt;li>merge files into one mdx file.&lt;/li>
&lt;/ol>
&lt;h2 id="code">Code
&lt;/h2>&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;span class="lnt">57
&lt;/span>&lt;span class="lnt">58
&lt;/span>&lt;span class="lnt">59
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">sys&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">os&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">split_file_by_lines&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file_path&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file_name&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">file_extension&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">splitext&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lines_per_file&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">28311&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">folder_path&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="s2">&amp;#34;divided_files&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="ow">not&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">exists&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">folder_path&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">makedirs&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">folder_path&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">raise&lt;/span> &lt;span class="ne">BaseException&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;directory exists&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;r&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;utf-8&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file_count&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lines&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">line&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lines&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">lines&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="n">lines_per_file&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">new_file_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">file_name&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">_&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">file_count&lt;/span>&lt;span class="si">:&lt;/span>&lt;span class="s2">02d&lt;/span>&lt;span class="si">}{&lt;/span>&lt;span class="n">file_extension&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">folder_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">new_file_name&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="s2">&amp;#34;w&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;utf-8&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">chunk_file&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">chunk_file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">writelines&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">lines&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lines&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file_count&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">new_file_name&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sa">f&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">file_name&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">_&lt;/span>&lt;span class="si">{&lt;/span>&lt;span class="n">file_count&lt;/span>&lt;span class="si">}{&lt;/span>&lt;span class="n">file_extension&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">folder_path&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">new_file_name&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="s2">&amp;#34;w&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;utf-8&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">chunk_file&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">chunk_file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">writelines&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">lines&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">file_count&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="mi">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">merge_files&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">files&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">output_file&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;res.txt&amp;#34;&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">output_file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;w&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">pass&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">file&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">files&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">isfile&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;r&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;utf-8&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">content&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">read&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">output_file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;a&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;utf-8&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">content&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">split_file_by_lines&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;./mdx.txt&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">system&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;ls ./divided_files | parallel -j16 &amp;#34;python3 ./prune.py ./divided_files/&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s1"> ./divided_files/new_&lt;/span>&lt;span class="si">{}&lt;/span>&lt;span class="s1">&amp;#34;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">merge_files&lt;/span>&lt;span class="p">([&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;./divided_files&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">f&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">listdir&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;./divided_files&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">isfile&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">os&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">path&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">join&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;./divided_files&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="ow">and&lt;/span> &lt;span class="n">f&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">startswith&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;new&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">shutil&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">shutil&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">rmtree&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;./divided_files&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>detailed pruning code:&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-python" data-lang="python">&lt;span class="line">&lt;span class="cl">&lt;span class="ch">#!/usr/bin/python&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">import&lt;/span> &lt;span class="nn">sys&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="kn">from&lt;/span> &lt;span class="nn">bs4&lt;/span> &lt;span class="kn">import&lt;/span> &lt;span class="n">BeautifulSoup&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">remove_tags_with_class&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">html_content&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">soup&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">BeautifulSoup&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">html_content&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">features&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;html.parser&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="n">tag&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">decompose&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">tag&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">soup&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_all&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;idm-gs-blk&amp;#34;&lt;/span>&lt;span class="p">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="n">tag&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">decompose&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">tag&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">soup&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_all&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;pv-gs-blk&amp;#34;&lt;/span>&lt;span class="p">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">def_tags&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">soup&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_all&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;def&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">def_tag&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">def_tags&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">xhtml_a_texts&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">a_tag&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">unwrap&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">a_tag&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">def_tag&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_all&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;xhtml:a&amp;#34;&lt;/span>&lt;span class="p">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="n">tag&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">decompose&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">tag&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">def_tag&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">find_all&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;chn&amp;#34;&lt;/span>&lt;span class="p">)]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">new_soup&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">BeautifulSoup&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sa">r&lt;/span>&lt;span class="s1">&amp;#39;&amp;lt;html&amp;gt;&amp;lt;body&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&amp;#39;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="s2">&amp;#34;html.parser&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">tag&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">def_tags&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">new_soup&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">body&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">append&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">tag&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">def_tag&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">def_tags&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">new_tag&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">soup&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">new_tag&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;p&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">new_tag&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">string&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">def_tag&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">get_text&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">def_tag&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">replace_with&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">new_tag&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="nb">str&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">new_soup&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">def&lt;/span> &lt;span class="nf">process_html_file&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">input_file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">output_file&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">input_file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;r&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;utf-8&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">file&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">lines&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">file&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">readlines&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">with&lt;/span> &lt;span class="nb">open&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">output_file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s2">&amp;#34;w&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">encoding&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;utf-8&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="k">as&lt;/span> &lt;span class="n">outfile&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">line&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">lines&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">line&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">strip&lt;/span>&lt;span class="p">()&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">startswith&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;&amp;lt;head&amp;gt;&amp;lt;link&amp;#34;&lt;/span>&lt;span class="p">):&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">new_line&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">remove_tags_with_class&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">outfile&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">new_line&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="se">\n&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">else&lt;/span>&lt;span class="p">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">outfile&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">line&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">input_file&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">sys&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">argv&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">output_file&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">sys&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">argv&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">process_html_file&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">input_file&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">output_file&lt;/span>&lt;span class="p">)&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script></description></item><item><title>Deep Learning 1</title><link>https://chenkeao.github.io/post/deep-learning-1/</link><pubDate>Wed, 01 Jan 2025 00:00:00 +0000</pubDate><guid>https://chenkeao.github.io/post/deep-learning-1/</guid><description>&lt;p>11&lt;/p></description></item><item><title>饥荒联机版专用服务器和多层世界配置指南</title><link>https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/</link><pubDate>Fri, 09 Jun 2023 00:00:00 +0000</pubDate><guid>https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/</guid><description>&lt;img src="https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/1.png" alt="Featured image of post 饥荒联机版专用服务器和多层世界配置指南" />&lt;blockquote>
&lt;p>此文全程处于&lt;code>linux&lt;/code>环境，阅读此文需具备一些&lt;code>linux&lt;/code>使用经验。&lt;/p>&lt;/blockquote>
&lt;p>解决饥荒卡顿有两个方法，如果你是单人联机玩家，可以添加&lt;a class="link" href="https://steamcommunity.com/sharedfiles/filedetails/?id=2657513551" target="_blank" rel="noopener"
>长路独行&lt;/a>模组，开启后就可以获得与单机版相同的游戏体验，此模组的原理的注意事项可以&lt;a class="link" href="https://dont-starve-mod.github.io/zh/dsa_index/" target="_blank" rel="noopener"
>点此查看&lt;/a>。
对于联机玩家，可以搭建专用服务器优化卡顿。饥荒联机版专用服务器 (Don&amp;rsquo;t Starve Together Dedicated Server) 是由 klei 官方提供的一个工具，购买饥荒联机版后，在Steam 的“库”页面勾选 &amp;ldquo;TOOLS&amp;rdquo; 后就可以看到了。
专用服务器可以在云服务器或PC上运行。如果你的电脑配置还可以，并且不要求服务器全天运行，完全可以在自己电脑上搭建专用服务器。
运行专用服务器每个世界大约需要&lt;code>1G&lt;/code>内存，同时运行游戏本身也需要内存，因此内存最好在&lt;code>8G&lt;/code>以上。如图1所示，第一个进程是游戏本身，占用了&lt;code>1.2G&lt;/code>的内存，第二个进程是专用服务器，占用了&lt;code>995M&lt;/code>左右的内存。&lt;/p>
&lt;p>&lt;img src="https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/3.png"
width="781"
height="117"
srcset="https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/3_hu_a5d89c1ceef36e2f.png 480w, https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/3_hu_17300349174998ac.png 1024w"
loading="lazy"
alt="图1"
class="gallery-image"
data-flex-grow="667"
data-flex-basis="1602px"
>&lt;/p>
&lt;h2 id="饥荒存档的构成">饥荒存档的构成
&lt;/h2>&lt;blockquote>
&lt;p>使用游戏本身创建的存档最多可以有一个森林和一个洞穴。但是饥荒专用服务器支持一个存档内包含任意多个森林和洞穴。&lt;/p>&lt;/blockquote>
&lt;p>专用服务器的运行单位是一个世界，而不是一个存档。比如说，一个存档中包括2个森林和2个洞穴，那么就需要启动4个专用服务器的进程实例。当然，你也可以不运行全部的世界，如果你不打算去某个世界，完全可以不启动它。这些进程通过网络通信，由于这种灵活的方式，你完全可以将一个存档中的不同的世界运行在不同的电脑上 (当然一般不需要这么做，除非你的世界太大了以至于一台电脑运行起来吃力)。&lt;/p>
&lt;p>唯一的限制是，每个存档必须有且仅有一个主世界 (Master Shard)，所有其他的世界都需要绑定到主世界。为了区分，每个世界都有一个唯一的&lt;code>id&lt;/code>，通过给洞穴入口或洞穴出口绑定不同的&lt;code>id&lt;/code>，玩家就可以通过他们在多个世界之间穿越。旺达的溯源表也绑定了世界的&lt;code>id&lt;/code>，因此可以穿越到不同的世界。如图2所示，这是一个拥有两个森林和两个洞穴的世界。其中一个森林是主世界，箭头代表可以通过洞穴入口或洞穴出口进出另一个世界。&lt;/p>
&lt;p>&lt;img src="https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/1.png"
width="4572"
height="3284"
srcset="https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/1_hu_d15d8a795bf7eee.png 480w, https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/1_hu_4f11717f69268b1f.png 1024w"
loading="lazy"
alt="图2"
class="gallery-image"
data-flex-grow="139"
data-flex-basis="334px"
>&lt;/p>
&lt;p>这个世界对应的存档结构如下:&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── &lt;span class="o">[&lt;/span>drwxr-xr-x&lt;span class="o">]&lt;/span> Master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── &lt;span class="o">[&lt;/span>drwxr-xr-x&lt;span class="o">]&lt;/span> Cave1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── &lt;span class="o">[&lt;/span>drwxr-xr-x&lt;span class="o">]&lt;/span> Cave2
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── &lt;span class="o">[&lt;/span>drwxr-xr-x&lt;span class="o">]&lt;/span> Forest1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── &lt;span class="o">[&lt;/span>-rw-r--r--&lt;span class="o">]&lt;/span> cluster.ini
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── &lt;span class="o">[&lt;/span>-rw-r--r--&lt;span class="o">]&lt;/span> cluster_token.txt&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>可以看出，每个世界都对应一个文件夹。此外，&lt;code>cluster.ini&lt;/code>存放了世界的一些参数设置，&lt;code>cluster_token.txt&lt;/code>里存放了用户的身份令牌 (身份令牌的获取参见下一章)。这些就是一个 存档的完整内容。
也可以去查看&lt;code>~/.klei/DontStarveTogether/$SteamUserID/&lt;/code>目录，如果你在本地创建了存档，那么这个目录下就会有以&lt;code>Cluster_X&lt;/code>格式命名的文件夹，其中&lt;code>X&lt;/code>是此存档在游戏中显示的位置。如图3所示，我创建了一个存档，那么此文件夹中就有一个&lt;code>Cluster_1&lt;/code>。&lt;/p>
&lt;p>&lt;img src="https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/2.png"
width="1336"
height="584"
srcset="https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/2_hu_e5399fa5443f3845.png 480w, https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/2_hu_dae6b3a704a2a372.png 1024w"
loading="lazy"
alt="图3"
class="gallery-image"
data-flex-grow="228"
data-flex-basis="549px"
>&lt;/p>
&lt;p>查看目录结构，可以看出我只添加了一个主世界，没有添加洞穴。由于只有在专用服务器上运行的存档才需要&lt;code>cluster_token.txt&lt;/code>，因此这里没有。&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">```bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Cluster_1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── Master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── cluster.ini&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;h2 id="在本地运行专用服务器">在本地运行专用服务器
&lt;/h2>&lt;h3 id="准备存档文件">准备存档文件
&lt;/h3>&lt;p>在游戏中创建存档，添加好要启用的模组并设置好世界的参数后生成世界。等待世界生成，进入选人物的步骤后，断开连接。&lt;/p>
&lt;blockquote>
&lt;p>一定要添加洞穴，否则存档无法在专用服务器中运行。&lt;/p>&lt;/blockquote>
&lt;p>进入&lt;code>~/.klei/DontStarveTogether/$SteamUserID/&lt;/code>目录，将刚刚创建的存档&lt;code>Cluster_X&lt;/code>(&lt;code>X&lt;/code>是此存档在游戏中显示的位置)移动到&lt;code>~/.klei/DontStarveTogether/&lt;/code>中。&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> ~/.klei/DontStarveTogether/&lt;span class="nv">$SteamUserID&lt;/span>/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mv Cluster_X ..&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>使用浏览器打开&lt;a class="link" href="https://accounts.klei.com/login" target="_blank" rel="noopener"
>Klei Account&lt;/a>，登录自己的&lt;code>Klei&lt;/code>账号，可以使用&lt;code>Steam&lt;/code>登录。登录成功后进入如下页面。&lt;/p>
&lt;p>&lt;img src="https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/4.png"
width="1904"
height="964"
srcset="https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/4_hu_773e06c67885510e.png 480w, https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/4_hu_b944523b3fc0a23d.png 1024w"
loading="lazy"
alt="图4"
class="gallery-image"
data-flex-grow="197"
data-flex-basis="474px"
>&lt;/p>
&lt;p>点击导航栏中的&lt;code>游戏&lt;/code>，在游戏列表中点击&lt;code>《饥荒：联机版》的游戏服务器&lt;/code>，如下图所示。&lt;/p>
&lt;p>&lt;img src="https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/5.png"
width="1365"
height="843"
srcset="https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/5_hu_745328fdd52dbb11.png 480w, https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/5_hu_9e2f93c1abe22259.png 1024w"
loading="lazy"
alt="图5"
class="gallery-image"
data-flex-grow="161"
data-flex-basis="388px"
>&lt;/p>
&lt;p>随便起一个名字，点击&lt;code>添加新服务器&lt;/code>，然后复制生成的以&lt;code>pds-g^&lt;/code>开头的代码，如下图所示。&lt;/p>
&lt;p>&lt;img src="https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/6.png"
width="1320"
height="565"
srcset="https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/6_hu_6d14b992fb944b33.png 480w, https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/6_hu_c37e44ad656196a3.png 1024w"
loading="lazy"
alt="图6"
class="gallery-image"
data-flex-grow="233"
data-flex-basis="560px"
>&lt;/p>
&lt;p>在&lt;code>~/.klei/DontStarveTogether/Cluster_X&lt;/code>中创建&lt;code>cluster_token.txt&lt;/code>文件，内容为刚刚复制的代码。&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;pds-g^...&amp;#34;&lt;/span> &amp;gt; cluster_token.txt&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>至此，存档文件就准备好了。&lt;/p>
&lt;h3 id="准备专用服务器和模组">准备专用服务器和模组
&lt;/h3>&lt;p>在&lt;code>Steam&lt;/code>中安装&lt;code>Don't Starve Together Dedicated Server&lt;/code>，进入安装目录 (安装目录可以在&lt;code>Steam&lt;/code>的游戏设置中找到)。
如果你的存档添加了模组，则需要修改&lt;code>mods&lt;/code>文件夹下的&lt;code>dedicated_server_mods_setup.lua&lt;/code>文件。专用服务器启动时，会根据这个文件的内容自动更新模组，如果你只在存档中添加了模组但是没有修改这个文件，则模组会添加失败。将需要添加的模组的&lt;code>id&lt;/code>以如下这种格式添加到此文件中即可。&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-lua" data-lang="lua">&lt;span class="line">&lt;span class="cl">&lt;span class="n">ServerModSetup&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;1438233888&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">--多层世界选择器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ServerModSetup&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;1418746242&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">--汉化增强 Chinese++&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">ServerModSetup&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s2">&amp;#34;666155465&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c1">--show me&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>模组的&lt;code>id&lt;/code>可以通过&lt;code>Steam&lt;/code>创意工坊中的链接查看。在&lt;code>Steam&lt;/code>中模组的详情页面右击空白处，选择&lt;code>Copy Page URL&lt;/code>。链接末尾的&lt;code>?id=&lt;/code>后接的就是它的&lt;code>id&lt;/code>。例如&lt;code>Show Me&lt;/code>的创意工坊链接为&lt;code>https://steamcommunity.com/sharedfiles/filedetails/?id=666155465&lt;/code>，其&lt;code>id&lt;/code>为&lt;code>666155465&lt;/code>。
除了这种方式，还可以查看此存档中主世界目录中的&lt;code>modoverrides.lua&lt;/code>文件，这个文件保存了当前世界启用的模组的设置。格式如下所示，其中&lt;code>workshop-&lt;/code>后接的数字就是模组的&lt;code>id&lt;/code>。&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-lua" data-lang="lua">&lt;span class="line">&lt;span class="cl">&lt;span class="kr">return&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;workshop-1418746242&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;configuration_options&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">{&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;clearfont&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="err">，&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;eventplus&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="err">，&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;extratrans&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">[&lt;/span>&lt;span class="s2">&amp;#34;enabled&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="kc">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>既然&lt;code>modoverrides.lua&lt;/code>文件已经保存了模组的&lt;code>id&lt;/code>，那么我们就可以使用脚本将所有添加的模组的&lt;code>id&lt;/code>提取出来。如下命令会根据&lt;code>modoverrides.lua&lt;/code>文件自动生成&lt;code>dedicated_server_mods_setup.lua&lt;/code>文件。&lt;code>cd&lt;/code>到&lt;code>modoverrides.lua&lt;/code>所在目录中执行如下命令，然后将生成的文件复制到&lt;code>专用服务器安装目录/mods&lt;/code>文件夹覆盖原有文件即可。&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">cat ./modoverrides.lua &lt;span class="p">|&lt;/span> grep -E &lt;span class="s1">&amp;#39;\[&amp;#34;workshop-[0-9]+&amp;#34;\].*&amp;#39;&lt;/span> &lt;span class="p">|&lt;/span> sed -r &lt;span class="s1">&amp;#39;s/\[&amp;#34;workshop-([0-9]+)&amp;#34;\].*/ServerModSetup(&amp;#34;\1&amp;#34;)/g&amp;#39;&lt;/span> &amp;gt; dedicated_server_mods_setup.lua&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;h3 id="启动专用服务器">启动专用服务器
&lt;/h3>&lt;p>&lt;code>cd&lt;/code>到安装目录中的&lt;code>bin64&lt;/code>文件夹，执行&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">./dontstarve_dedicated_server_nullrenderer_x64 -console -cluster &lt;span class="s2">&amp;#34;Cluster_X&amp;#34;&lt;/span> -monitor_parent_process &lt;span class="nv">$$&lt;/span> -shard Caves &lt;span class="p">&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./dontstarve_dedicated_server_nullrenderer_x64 -console -cluster &lt;span class="s2">&amp;#34;Cluster_X&amp;#34;&lt;/span> -monitor_parent_process &lt;span class="nv">$$&lt;/span> -shard Master&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>&lt;code>-console&lt;/code>指定在游戏中启用控制台。
&lt;code>-cluster&lt;/code>指定存档的名字，这个名字和要运行的存档文件夹名对应。
&lt;code>-shard&lt;/code>指定世界碎片的名字。同样，这个名字也要和世界碎片的文件夹名对应。&lt;/p>
&lt;blockquote>
&lt;p>在&lt;code>cluster.ini&lt;/code>中也可以指定一个名称，这个名称是在游戏中玩家看的世界名称。而&lt;code>-cluster&lt;/code>指定的只是文件夹的名称，在游戏中是看不到的。&lt;/p>&lt;/blockquote>
&lt;h2 id="在云服务器运行专用服务器">在云服务器运行专用服务器
&lt;/h2>&lt;p>购买阿里云或腾讯云提供的云服务器，配置选择&lt;code>1核2G&lt;/code>或者&lt;code>2核4G&lt;/code>即可。安装&lt;code>Debian&lt;/code>或&lt;code>Ubuntu&lt;/code>操作系统，在安全组中开放&lt;code>10888-10999&lt;/code>端口。此处以&lt;code>Debian&lt;/code>为例。&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl"> _,met&lt;span class="nv">$$$$$gg&lt;/span>. momo@debian
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ,g&lt;span class="nv">$$$$$$$$$$$$$$$P&lt;/span>. -----------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ,g&lt;span class="nv">$$&lt;/span>P&lt;span class="s2">&amp;#34; &amp;#34;&amp;#34;&amp;#34;&lt;/span>Y&lt;span class="nv">$$&lt;/span>.&lt;span class="s2">&amp;#34;. OS: Debian GNU/Linux 11 (bullseye) x86_64
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> ,&lt;/span>&lt;span class="nv">$$&lt;/span>&lt;span class="s2">P&amp;#39; `&lt;/span>&lt;span class="nv">$$&lt;/span>$&lt;span class="s2">. Host: VirtualBox 1.2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#39;,&lt;/span>&lt;span class="nv">$$&lt;/span>&lt;span class="s2">P ,ggs. `&lt;/span>&lt;span class="nv">$$&lt;/span>&lt;span class="s2">b: Kernel: 5.10.0-23-amd64
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">`d&lt;/span>&lt;span class="nv">$$&lt;/span>&lt;span class="s2">&amp;#39; ,&lt;/span>&lt;span class="nv">$P&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="s1">&amp;#39; . $$$ Uptime: 1 min
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> $$P d$&amp;#39;&lt;/span> ， &lt;span class="nv">$$&lt;/span>P Packages: &lt;span class="m">444&lt;/span> &lt;span class="o">(&lt;/span>dpkg&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nv">$$&lt;/span>: &lt;span class="nv">$$&lt;/span>. - ,d&lt;span class="nv">$$&lt;/span>&lt;span class="s1">&amp;#39; Shell: bash 5.1.4
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1"> $$; Y$b._ _,d$P&amp;#39;&lt;/span> Resolution: preferred
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> Y&lt;span class="nv">$$&lt;/span>. &lt;span class="sb">`&lt;/span>.&lt;span class="sb">`&lt;/span>&lt;span class="s2">&amp;#34;Y&lt;/span>&lt;span class="nv">$$$$&lt;/span>&lt;span class="s2">P&amp;#34;&lt;/span>&lt;span class="err">&amp;#39;&lt;/span> Terminal: /dev/pts/0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>&lt;span class="nv">$$&lt;/span>b &lt;span class="s2">&amp;#34;-.__ CPU: Intel i5-7300HQ (2) @ 2.496GHz
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> `Y&lt;/span>&lt;span class="nv">$$&lt;/span>&lt;span class="s2"> GPU: 00:02.0 VMware SVGA II Adapter
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> `Y&lt;/span>&lt;span class="nv">$$&lt;/span>&lt;span class="s2">. Memory: 78MiB / 3919MiB
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> `&lt;/span>&lt;span class="nv">$$&lt;/span>&lt;span class="s2">b.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> `Y&lt;/span>&lt;span class="nv">$$&lt;/span>&lt;span class="s2">b.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2"> `&amp;#34;&lt;/span>Y&lt;span class="nv">$b&lt;/span>._
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>&lt;span class="s2">&amp;#34;&amp;#34;&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;ul>
&lt;li>添加&lt;code>32&lt;/code>位支持&lt;/li>
&lt;/ul>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo dpkg --add-architecture i386
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt update &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> sudo apt upgrade -y&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;ul>
&lt;li>安装依赖&lt;/li>
&lt;/ul>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">sudo apt install libstdc++6:i386 libgcc1:i386 libcurl4-gnutls-dev:i386 -y&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;ul>
&lt;li>安装&lt;code>SteamCMD&lt;/code>&lt;/li>
&lt;/ul>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 这一步的速度视网络环境而定&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir -p ~/steamcmd/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> ~/steamcmd/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">wget &lt;span class="s2">&amp;#34;https://steamcdn-a.akamaihd.net/client/installer/steamcmd_linux.tar.gz&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">tar -xvzf steamcmd_linux.tar.gz&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;ul>
&lt;li>准备存档文件
这一步骤与上一章中的相同，可以在本地生成存档文件夹，然后上传到服务器。&lt;/li>
&lt;/ul>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 在服务器&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">mkdir -p ~/.klei/DoNotStarveTogether
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 在本地&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> ~/.klei/DoNotStarveTogether
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">scp -r ./Cluster_X username@xxx.xxx.xxx.xxx:~/.klei/DoNotStarveTogether/&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;ul>
&lt;li>将以下内容写入&lt;code>run_server.sh&lt;/code>文件并赋予其执行权限。&lt;/li>
&lt;/ul>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="cp">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="cp">&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">steamcmd_dir&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$HOME&lt;/span>&lt;span class="s2">/steamcmd&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">install_dir&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$HOME&lt;/span>&lt;span class="s2">/dontstarvetogether_dedicated_server&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">cluster_name&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$1&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">dontstarve_dir&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$HOME&lt;/span>&lt;span class="s2">/.klei/DoNotStarveTogether&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> fail&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">echo&lt;/span> Error: &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$@&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nb">exit&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> check_for_file&lt;span class="o">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="o">[&lt;/span> ! -e &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$1&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">]&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">then&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> fail &lt;span class="s2">&amp;#34;Missing file: &lt;/span>&lt;span class="nv">$1&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$steamcmd_dir&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="o">||&lt;/span> fail &lt;span class="s2">&amp;#34;Missing &lt;/span>&lt;span class="nv">$steamcmd_dir&lt;/span>&lt;span class="s2"> directory!&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">check_for_file &lt;span class="s2">&amp;#34;steamcmd.sh&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">check_for_file &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$dontstarve_dir&lt;/span>&lt;span class="s2">/&lt;/span>&lt;span class="nv">$cluster_name&lt;/span>&lt;span class="s2">/cluster.ini&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">check_for_file &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$dontstarve_dir&lt;/span>&lt;span class="s2">/&lt;/span>&lt;span class="nv">$cluster_name&lt;/span>&lt;span class="s2">/cluster_token.txt&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">check_for_file &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$dontstarve_dir&lt;/span>&lt;span class="s2">/&lt;/span>&lt;span class="nv">$cluster_name&lt;/span>&lt;span class="s2">/Master/server.ini&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">check_for_file &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$dontstarve_dir&lt;/span>&lt;span class="s2">/&lt;/span>&lt;span class="nv">$cluster_name&lt;/span>&lt;span class="s2">/Caves/server.ini&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">./steamcmd.sh +force_install_dir &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$install_dir&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> +login anonymous +app_update &lt;span class="m">343050&lt;/span> validate +quit
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">check_for_file &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$install_dir&lt;/span>&lt;span class="s2">/bin64&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cat &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$dontstarve_dir&lt;/span>&lt;span class="s2">/&lt;/span>&lt;span class="nv">$cluster_name&lt;/span>&lt;span class="s2">/Master/modoverrides.lua&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> grep -E &lt;span class="s1">&amp;#39;\[&amp;#34;workshop-[0-9]+&amp;#34;\].*&amp;#39;&lt;/span> &lt;span class="p">|&lt;/span> sed -r &lt;span class="s1">&amp;#39;s/\[&amp;#34;workshop-([0-9]+)&amp;#34;\].*/ServerModSetup(&amp;#34;\1&amp;#34;)/g&amp;#39;&lt;/span> &amp;gt; &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$install_dir&lt;/span>&lt;span class="s2">/mods/dedicated_server_mods_setup.lua&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">cd&lt;/span> &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$install_dir&lt;/span>&lt;span class="s2">/bin64&amp;#34;&lt;/span> &lt;span class="o">||&lt;/span> fail
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">run_shared&lt;/span>&lt;span class="o">=(&lt;/span>./dontstarve_dedicated_server_nullrenderer_x64&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">run_shared&lt;/span>&lt;span class="o">+=(&lt;/span>-console&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">run_shared&lt;/span>&lt;span class="o">+=(&lt;/span>-cluster &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$cluster_name&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nv">run_shared&lt;/span>&lt;span class="o">+=(&lt;/span>-monitor_parent_process &lt;span class="nv">$$&lt;/span>&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">run_shared&lt;/span>&lt;span class="p">[@]&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> -shard Caves &lt;span class="p">|&lt;/span> sed &lt;span class="s1">&amp;#39;s/^/Caves: /&amp;#39;&lt;/span> &lt;span class="p">&amp;amp;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="si">${&lt;/span>&lt;span class="nv">run_shared&lt;/span>&lt;span class="p">[@]&lt;/span>&lt;span class="si">}&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> -shard Master &lt;span class="p">|&lt;/span> sed &lt;span class="s1">&amp;#39;s/^/Master: /&amp;#39;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>这个脚本是我在&lt;code>Klei&lt;/code>官方提供的脚本的基础上优化修改而来。运行时需要提供存档文件夹的名称作为脚本的第一个参数。脚本将会检查存档文件是否完整，使用&lt;code>SteamCMD&lt;/code>更新专用服务器并根据存档的模组设置文件&lt;code>modoverrides.lua&lt;/code>自动生成&lt;code>dedicated_server_mods_setup.lua&lt;/code>文件。&lt;/p>
&lt;ul>
&lt;li>运行脚本&lt;/li>
&lt;/ul>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">./run_server.sh Cluster_X&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>由于第一次运行时要下载专用服务器，速度会比较慢。当终端输出&lt;code>Sim paused&lt;/code>时就说明启动完毕，可以在游戏中搜索加入了。&lt;/p>
&lt;blockquote>
&lt;p>可以使用&lt;code>tmux&lt;/code>或&lt;code>screen&lt;/code>等工具，这样脚本就可以在后台运行了。&lt;/p>&lt;/blockquote>
&lt;h2 id="多层世界">多层世界
&lt;/h2>&lt;p>理论上来说，一个存档中可以添加无数个世界。配置多层世界需要修改存档根目录中的&lt;code>cluster.ini&lt;/code>和每个世界目录中的&lt;code>server.ini&lt;/code>。
首先看一下的&lt;code>cluster.ini&lt;/code>的内容。&lt;/p>
&lt;blockquote>
&lt;p>TODO 文件内容分析&lt;/p>&lt;/blockquote>
&lt;p>使用多层世界选择器可以解决给洞穴入口绑定&lt;code>id&lt;/code>的麻烦。类似于路由器的工作方式，玩家选择目标世界，由多层世界选择器将玩家送到对应世界，如图7所示。&lt;/p>
&lt;p>&lt;img src="https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/7.png"
width="5284"
height="3284"
srcset="https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/7_hu_a7a906cb0a78475b.png 480w, https://chenkeao.github.io/post/dst-dedicated-server-multilevel-world-setup-guide/7_hu_482376d2d41c2926.png 1024w"
loading="lazy"
alt="图7"
class="gallery-image"
data-flex-grow="160"
data-flex-basis="386px"
>&lt;/p>
&lt;h2 id="常见问题">常见问题
&lt;/h2>&lt;h3 id="connecting-anonymously-to-steam-public-retry-retry">Connecting anonymously to Steam Public&amp;hellip;: Retry Retry
&lt;/h3>&lt;p>无法连接到&lt;code>Steam&lt;/code>的服务器，这一般是由于&lt;code>GFW&lt;/code>，科学上网即可解决。&lt;/p>
&lt;h3 id="服务器启动失败-cluster_tokentxt-do-not-exist">服务器启动失败: cluster_token.txt do not exist
&lt;/h3>&lt;p>检查&lt;code>cluster_token.txt&lt;/code>是否存在，内容是否正确。&lt;/p>
&lt;h3 id="服务器启动失败-libcurl-gnultsso4">服务器启动失败: libcurl-gnults.so.4
&lt;/h3>&lt;p>安装&lt;code>libcurl-gnults&lt;/code>。&lt;/p>
&lt;h3 id="全部模组没有添加成功">全部模组没有添加成功
&lt;/h3>&lt;p>查看&lt;code>modoverrides.lua&lt;/code>和&lt;code>dedicated_server_mods_setup.lua&lt;/code>是否都存在，内容是否正确。&lt;/p>
&lt;h3 id="部分模组没有添加成功">部分模组没有添加成功
&lt;/h3>&lt;p>因为网络原因，有时专用服务器会在下载某些模组时失败。如果运行后发现只有一部分模组，一般重新运行专用服务器即可。&lt;/p>
&lt;h3 id="游戏大厅内无法搜索到世界">游戏大厅内无法搜索到世界
&lt;/h3>&lt;p>可以通过控制台指令&lt;code>c_connect(&amp;quot;xxx.xxx.xxx.xxx&amp;quot;，10999，&amp;quot;password&amp;quot;)&lt;/code>加入世界，其中第一个参数是服务器的&lt;code>IP&lt;/code>地址，第二个参数是主世界碎片的端口号，第三个参数是世界的密码。&lt;/p></description></item><item><title>GNU Parallel 的妙用</title><link>https://chenkeao.github.io/post/gnu-parallel-tips/</link><pubDate>Thu, 08 Jun 2023 00:00:00 +0000</pubDate><guid>https://chenkeao.github.io/post/gnu-parallel-tips/</guid><description>&lt;p>Android QQ 的图片文件是以下面这种结构保存的，以&lt;code>Cache_&lt;/code>开头的文件就是图片。这种结构在浏览时要分别点进每个文件夹才能看到图片，很不方便。&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">├── 0a0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── Cache_2783644ca99260a0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   └── Cache_-4dfb57e9a7cec0a0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── 0a6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── Cache_373e35b7b8a290a6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   ├── Cache_-489f6e9c62ea10a6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">│   └── Cache_57776dc1e17110a6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── 0a7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> └── Cache_25d732f84bd7d0a7&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>使用 GNU Parallel 配合&lt;code>mv&lt;/code>可以快速的 “解散” 每个二级文件夹，变成以下这种结构。&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── Cache_25d732f84bd7d0a7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── Cache_2783644ca99260a0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── Cache_373e35b7b8a290a6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── Cache_-489f6e9c62ea10a6
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">├── Cache_-4dfb57e9a7cec0a0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">└── Cache_57776dc1e17110a6&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>命令如下:&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">find . -name &lt;span class="s2">&amp;#34;*&amp;#34;&lt;/span> -type f -print &lt;span class="p">|&lt;/span> parallel mv &lt;span class="o">{}&lt;/span> ./&lt;span class="o">{&lt;/span>/&lt;span class="o">}&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;blockquote>
&lt;p>参考: &lt;a class="link" href="https://www.myfreax.com/gnu-parallel/" target="_blank" rel="noopener"
>https://www.myfreax.com/gnu-parallel/&lt;/a>&lt;/p>&lt;/blockquote></description></item><item><title>使用 Shell 批量修改文件后缀和批量格式转换</title><link>https://chenkeao.github.io/post/batch-rename-file-extensions-and-format-conversion-in-linux/</link><pubDate>Tue, 06 Jun 2023 00:00:00 +0000</pubDate><guid>https://chenkeao.github.io/post/batch-rename-file-extensions-and-format-conversion-in-linux/</guid><description>&lt;p>&lt;code>shell&lt;/code>脚本是处理这类工作最为简单，快捷的方式。&lt;/p>
&lt;h2 id="修改后缀">修改后缀
&lt;/h2>&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> file in *.原后缀&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span> mv &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$file&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="s2">&amp;#34;`echo &lt;/span>&lt;span class="nv">$file&lt;/span>&lt;span class="s2"> | sed s/.原后缀/.新后缀/`&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">done&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;h2 id="格式转换">格式转换
&lt;/h2>&lt;h3 id="heic-转-jpg">heic 转 jpg
&lt;/h3>&lt;p>首先，安装转换工具。&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">yay -S libheif&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>然后可以使用&lt;code>heif-convert&lt;/code>命令转换。&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">heif-convert input.heic output.jpg&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>批量转换，命令如下。&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> file in *.heic&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span> heif-convert &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$file&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">file&lt;/span>&lt;span class="p">/%.heic/.jpg&lt;/span>&lt;span class="si">}&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> rm &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$file&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">done&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>这条命令的原理是：根据当前文件夹下的&lt;code>.heic&lt;/code>文件生成&lt;code>.jpg&lt;/code>文件，如果成功生成则删除原&lt;code>.heic&lt;/code>文件，如果未成功则不会删除原文件。 此外，如果未能生成&lt;code>.jpg&lt;/code>文件的原因是&lt;code>Input file 'filename.heic' is a JPEG image&lt;/code>，那么可以使用批量修改后缀的方法直接将文件的后缀改为&lt;code>.jpg&lt;/code>。&lt;/p>
&lt;h3 id="flac-转-mp3">flac 转 mp3
&lt;/h3>&lt;p>首先，安装转换工具：&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">yay -S ffmpeg&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>然后可以使用&lt;code>ffmpeg&lt;/code>命令转换，除了格式转换，&lt;code>ffmpeg&lt;/code>还支持很多功能，具体可以查阅&lt;a class="link" href="%22https://ffmpeg.org/documentation.html%22" >文档&lt;/a>。&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ffmpeg -i &lt;span class="s1">&amp;#39;input.flac&amp;#39;&lt;/span> -ab 320k -map_metadata &lt;span class="m">0&lt;/span> -id3v2_version &lt;span class="m">3&lt;/span> &lt;span class="s1">&amp;#39;output.mp3&amp;#39;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>批量转换，命令如下：&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="k">for&lt;/span> file in *.flac&lt;span class="p">;&lt;/span> &lt;span class="k">do&lt;/span> ffmpeg -i &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$file&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span> -ab 320k -map_metadata &lt;span class="m">0&lt;/span> -id3v2_version &lt;span class="m">3&lt;/span> &lt;span class="si">${&lt;/span>&lt;span class="nv">file&lt;/span>&lt;span class="p">/%.flac/.mp3&lt;/span>&lt;span class="si">}&lt;/span> &lt;span class="o">&amp;amp;&amp;amp;&lt;/span> rm &lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="nv">$file&lt;/span>&lt;span class="s2">&amp;#34;&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="k">done&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>原理同上。&lt;/p>
&lt;h3 id="速度优化">速度优化
&lt;/h3>&lt;p>使用&lt;code>for&lt;/code>循环的方式，所有文件排着队一个一个的被&lt;code>ffmpeg&lt;/code>处理。 这种方式固然可以，但效率太低了。 我的运行环境如下:&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl"> -&lt;span class="sb">`&lt;/span> momo@momo-arch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> .o+&lt;span class="sb">`&lt;/span> --------------
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>ooo/ OS: Arch Linux x86_64
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>+oooo: Host: 81AC Lenovo ideapad 720S-15IKB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>+oooooo: Kernel: 6.3.6-arch1-1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -+oooooo+: Uptime: &lt;span class="m">6&lt;/span> hours, &lt;span class="m">59&lt;/span> mins
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>/:-:++oooo+: Packages: &lt;span class="m">975&lt;/span> &lt;span class="o">(&lt;/span>pacman&lt;span class="o">)&lt;/span>, &lt;span class="m">8&lt;/span> &lt;span class="o">(&lt;/span>flatpak&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>/++++/+++++++: Shell: bash 5.1.16
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>/++++++++++++++: Resolution: 1920x1080
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>/+++ooooooooooooo/&lt;span class="sb">`&lt;/span> DE: Plasma 5.27.5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> ./ooosssso++osssssso+&lt;span class="sb">`&lt;/span> WM: kwin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> .oossssso-&lt;span class="sb">````&lt;/span>/ossssss+&lt;span class="sb">`&lt;/span> Theme: &lt;span class="o">[&lt;/span>Plasma&lt;span class="o">]&lt;/span>, Layan-Light-Solid &lt;span class="o">[&lt;/span>GTK2/3&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> -osssssso. :ssssssso. Icons: Papirus &lt;span class="o">[&lt;/span>Plasma&lt;span class="o">]&lt;/span>, Papirus &lt;span class="o">[&lt;/span>GTK2/3&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> :osssssss/ osssso+++. Terminal: konsole
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> /ossssssss/ +ssssooo/- CPU: Intel i5-7300HQ &lt;span class="o">(&lt;/span>4&lt;span class="o">)&lt;/span> @ 3.500GHz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>/ossssso+/:- -:/+osssso+- GPU: Intel HD Graphics &lt;span class="m">630&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>+sso+:-&lt;span class="sb">`&lt;/span> &lt;span class="sb">`&lt;/span>.-/+oso: Memory: 7216MiB / 19554MiB
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="sb">`&lt;/span>++:. &lt;span class="sb">`&lt;/span>-/+/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> .&lt;span class="sb">`&lt;/span> &lt;span class="sb">`&lt;/span>/ &lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>经过测试，处理&lt;code>10&lt;/code>个&lt;code>.flac&lt;/code>文件所需时间为&lt;code>59&lt;/code>秒。 速度慢的原因是目前使用的是单进程串行的处理方式，为了提高速度，可以同时启动多个进程并行处理。&lt;/p>
&lt;p>使用终端工具&lt;a class="link" href="%22https://www.gnu.org/software/parallel/sphinx.html%22" >GNU Parallel&lt;/a>，命令如下：&lt;/p>
&lt;div class="collapsible-code">
&lt;div class="code-header" onclick="toggleCode(this)">
&lt;span class="icon">▼&lt;/span>
&lt;/div>
&lt;div class="code-body">
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">ls *.flac &lt;span class="p">|&lt;/span> parallel -j4 &lt;span class="s2">&amp;#34;ffmpeg -i {} -ab 320k -map_metadata 0 -id3v2_version 3 {.}.mp3 &amp;amp;&amp;amp; rm {}&amp;#34;&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;/div>
&lt;style>
.collapsible-code .code-body {
overflow: hidden;
margin-left: calc((var(--card-padding)) * -1);
margin-right: calc((var(--card-padding)) * -1);
width: calc(100% + var(--card-padding) * 2);
padding: 0 var(--card-padding);
}
.collapsible-code .code-header {
display: flex;
align-items: center;
cursor: pointer;
user-select: none;
}
.collapsible-code .code-header .icon {
font-size: 0.65em;
color: var(--card-text-color-main);
transition: transform 0.2s ease;
}
.collapsible-code.collapsed .code-body {
display: none;
}
.collapsible-code.collapsed .icon {
transform: rotate(-90deg);
}
&lt;/style>
&lt;script>
function toggleCode(header) {
const wrapper = header.closest(".collapsible-code");
wrapper.classList.toggle("collapsed");
}
&lt;/script>
&lt;p>&lt;code>parallel&lt;/code>将从标准输入中读取文件列表，&lt;code>-j&lt;/code>指定了并行进程数，&lt;code>{}&lt;/code>代表输入文件名，&lt;code>{.}&lt;/code>代表没有后缀的输入文件名，其他用法可以&lt;code>man parallel&lt;/code>查看。&lt;/p>
&lt;p>经过测试，在同样环境下处理同样的&lt;code>.flac&lt;/code>文件仅需&lt;code>17&lt;/code>秒。&lt;/p></description></item></channel></rss>